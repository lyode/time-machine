<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cosmic Nebula Smoke Wave Visualizer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: #000;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            position: relative;
        }

        /* Cosmic starfield background */
        .starfield {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(2px 2px at 20px 30px, #ffffff, transparent),
                radial-gradient(2px 2px at 40px 70px, rgba(255, 100, 100, 0.8), transparent),
                radial-gradient(1px 1px at 90px 40px, #ffffff, transparent),
                radial-gradient(1px 1px at 130px 80px, rgba(100, 150, 255, 0.6), transparent),
                radial-gradient(2px 2px at 160px 30px, #ffffff, transparent),
                radial-gradient(1px 1px at 200px 120px, rgba(255, 200, 100, 0.7), transparent),
                radial-gradient(1px 1px at 250px 60px, #ffffff, transparent),
                radial-gradient(2px 2px at 300px 100px, rgba(255, 150, 200, 0.8), transparent);
            background-repeat: repeat;
            background-size: 350px 350px;
            animation: starTwinkle 6s ease-in-out infinite alternate;
        }

        @keyframes starTwinkle {
            0% { opacity: 0.6; }
            100% { opacity: 1; }
        }

        /* Main nebula container */
        .nebula-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        /* Cosmic smoke waves */
        .cosmic-wave {
            position: absolute;
            border-radius: 50%;
            filter: blur(40px);
            mix-blend-mode: screen;
            animation: cosmicFlow 20s ease-in-out infinite;
            opacity: 0.8;
        }

        /* Primary flowing nebula */
        .wave-primary {
            width: 800px;
            height: 400px;
            background: linear-gradient(45deg, 
                rgba(0, 150, 255, 0.6) 0%,
                rgba(100, 50, 255, 0.8) 30%,
                rgba(255, 100, 150, 0.7) 60%,
                rgba(255, 200, 100, 0.6) 100%);
            top: 20%;
            left: -200px;
            animation-duration: 25s;
        }

        /* Secondary flowing nebula */
        .wave-secondary {
            width: 600px;
            height: 300px;
            background: linear-gradient(-45deg, 
                rgba(255, 100, 200, 0.5) 0%,
                rgba(150, 100, 255, 0.7) 40%,
                rgba(100, 200, 255, 0.6) 100%);
            top: 50%;
            right: -150px;
            animation-duration: 30s;
            animation-delay: -10s;
        }

        /* Tertiary cosmic cloud */
        .wave-tertiary {
            width: 700px;
            height: 350px;
            background: radial-gradient(ellipse at center, 
                rgba(255, 150, 100, 0.4) 0%,
                rgba(255, 100, 255, 0.6) 30%,
                rgba(100, 150, 255, 0.5) 60%,
                transparent 100%);
            top: 10%;
            right: 10%;
            animation-duration: 35s;
            animation-delay: -20s;
        }

        /* Smaller flowing wisps */
        .wave-wisp {
            width: 300px;
            height: 150px;
            background: radial-gradient(ellipse at center, 
                rgba(255, 200, 255, 0.4) 0%,
                rgba(150, 255, 200, 0.3) 50%,
                transparent 100%);
            animation-duration: 15s;
            filter: blur(25px);
        }

        .wave-wisp-1 {
            top: 70%;
            left: 20%;
            animation-delay: -5s;
        }

        .wave-wisp-2 {
            top: 30%;
            left: 70%;
            animation-delay: -12s;
        }

        .wave-wisp-3 {
            top: 80%;
            right: 30%;
            animation-delay: -8s;
        }

        /* Cosmic flow animation */
        @keyframes cosmicFlow {
            0% {
                transform: translateX(0px) translateY(0px) rotate(0deg) scaleX(1) scaleY(1);
            }
            25% {
                transform: translateX(100px) translateY(-50px) rotate(90deg) scaleX(1.2) scaleY(0.8);
            }
            50% {
                transform: translateX(200px) translateY(50px) rotate(180deg) scaleX(0.9) scaleY(1.3);
            }
            75% {
                transform: translateX(50px) translateY(100px) rotate(270deg) scaleX(1.1) scaleY(0.9);
            }
            100% {
                transform: translateX(0px) translateY(0px) rotate(360deg) scaleX(1) scaleY(1);
            }
        }

        /* Cosmic dust particles */
        .cosmic-dust {
            position: absolute;
            width: 2px;
            height: 2px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 50%;
            animation: dustFloat 8s linear infinite;
        }

        @keyframes dustFloat {
            0% {
                transform: translateY(100vh) translateX(0px) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) translateX(50px) rotate(360deg);
                opacity: 0;
            }
        }

        /* Audio-reactive smoke waves */
        .audio-wave {
            position: absolute;
            border-radius: 50%;
            filter: blur(30px);
            mix-blend-mode: screen;
            animation: audioReactive 2s ease-in-out infinite;
            opacity: 0;
            transition: all 0.3s ease;
        }

        @keyframes audioReactive {
            0% {
                transform: scale(0.8);
                opacity: 0.3;
            }
            50% {
                transform: scale(1.2);
                opacity: 0.8;
            }
            100% {
                transform: scale(1.5);
                opacity: 0;
            }
        }

        /* Pulsing energy orbs */
        .energy-orb {
            position: absolute;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, 
                rgba(255, 255, 255, 0.8) 0%,
                rgba(100, 200, 255, 0.6) 30%,
                rgba(255, 100, 200, 0.4) 70%,
                transparent 100%);
            filter: blur(20px);
            animation: orbPulse 4s ease-in-out infinite;
            mix-blend-mode: screen;
        }

        .energy-orb-1 {
            top: 25%;
            left: 30%;
            animation-delay: 0s;
        }

        .energy-orb-2 {
            top: 60%;
            right: 25%;
            animation-delay: -2s;
        }

        .energy-orb-3 {
            bottom: 20%;
            left: 60%;
            animation-delay: -1s;
        }

        @keyframes orbPulse {
            0%, 100% {
                transform: scale(1);
                opacity: 0.6;
            }
            50% {
                transform: scale(1.3);
                opacity: 0.9;
            }
        }

        /* Control panel */
        .control-panel {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(15px);
            padding: 20px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 24px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
            box-shadow: 0 0 30px rgba(100, 150, 255, 0.5);
        }

        .control-btn.active {
            background: rgba(100, 150, 255, 0.3);
            border-color: #64a6ff;
            box-shadow: 0 0 30px rgba(100, 150, 255, 0.7);
        }

        /* Info panel */
        .info-panel {
            position: fixed;
            top: 30px;
            right: 30px;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(15px);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 14px;
            max-width: 300px;
            z-index: 1000;
        }

        .info-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #64a6ff, #ff64a6, #ffa664);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .info-item {
            margin-bottom: 8px;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Intensity indicator */
        .intensity-indicator {
            position: fixed;
            top: 30px;
            left: 30px;
            width: 60px;
            height: 200px;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(15px);
            border-radius: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            z-index: 1000;
            overflow: hidden;
        }

        .intensity-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(to top, 
                #ff4444 0%, 
                #ff8844 25%, 
                #ffff44 50%, 
                #88ff44 75%, 
                #4488ff 100%);
            transition: height 0.1s ease;
            border-radius: 0 0 30px 30px;
        }

        .intensity-label {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 12px;
            font-weight: bold;
        }

        /* Fullscreen mode */
        .fullscreen-toggle {
            position: fixed;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            padding: 10px 20px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            z-index: 1000;
        }

        .fullscreen-toggle:hover {
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 0 20px rgba(100, 150, 255, 0.5);
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .control-panel {
                bottom: 20px;
                padding: 15px;
            }
            
            .control-btn {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
            
            .info-panel {
                top: 20px;
                right: 20px;
                max-width: 250px;
                font-size: 12px;
            }
            
            .intensity-indicator {
                top: 20px;
                left: 20px;
                width: 50px;
                height: 150px;
            }
        }

        /* Custom scrollbar for webkit browsers */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(100, 150, 255, 0.5);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(100, 150, 255, 0.7);
        }
    </style>
</head>
<body>
    <!-- Starfield background -->
    <div class="starfield"></div>

    <!-- Main nebula container -->
    <div class="nebula-container">
        <!-- Primary cosmic waves -->
        <div class="cosmic-wave wave-primary"></div>
        <div class="cosmic-wave wave-secondary"></div>
        <div class="cosmic-wave wave-tertiary"></div>
        
        <!-- Smaller wisps -->
        <div class="cosmic-wave wave-wisp wave-wisp-1"></div>
        <div class="cosmic-wave wave-wisp wave-wisp-2"></div>
        <div class="cosmic-wave wave-wisp wave-wisp-3"></div>
        
        <!-- Energy orbs -->
        <div class="energy-orb energy-orb-1"></div>
        <div class="energy-orb energy-orb-2"></div>
        <div class="energy-orb energy-orb-3"></div>
    </div>

    <!-- Intensity indicator -->
    <div class="intensity-indicator">
        <div class="intensity-label">INTENSITY</div>
        <div class="intensity-bar" id="intensityBar"></div>
    </div>

    <!-- Fullscreen toggle -->
    <div class="fullscreen-toggle" id="fullscreenToggle">
        üîç Fullscreen Experience
    </div>

    <!-- Info panel -->
    <div class="info-panel">
        <div class="info-title">üåå Cosmic Nebula Visualizer</div>
        <div class="info-item">üé§ <strong>Audio Mode:</strong> <span id="audioStatus">Inactive</span></div>
        <div class="info-item">üéµ <strong>Music Mode:</strong> <span id="musicStatus">Ready</span></div>
        <div class="info-item">‚ö° <strong>Intensity:</strong> <span id="intensityValue">0%</span></div>
        <div class="info-item">üåü <strong>Particles:</strong> <span id="particleCount">0</span></div>
        <div class="info-item">üé® <strong>Effect:</strong> <span id="currentEffect">Cosmic Flow</span></div>
    </div>

    <!-- Control panel -->
    <div class="control-panel">
        <button class="control-btn" id="audioBtn" title="Toggle Audio Input">üé§</button>
        <button class="control-btn" id="musicBtn" title="Generate Music Waves">üéµ</button>
        <button class="control-btn" id="effectBtn" title="Change Effect Mode">‚ö°</button>
        <button class="control-btn" id="colorBtn" title="Cycle Colors">üé®</button>
        <button class="control-btn" id="settingsBtn" title="Settings">‚öôÔ∏è</button>
    </div>

    <script>
        class CosmicNebulaVisualizer {
            constructor() {
                this.audioContext = null;
                this.analyser = null;
                this.microphone = null;
                this.dataArray = null;
                this.isListening = false;
                this.isMusicMode = false;
                this.animationId = null;
                this.particleCount = 0;
                this.currentEffect = 'cosmic';
                this.currentColorScheme = 0;
                
                this.nebulaContainer = document.querySelector('.nebula-container');
                this.intensityBar = document.getElementById('intensityBar');
                this.audioStatus = document.getElementById('audioStatus');
                this.musicStatus = document.getElementById('musicStatus');
                this.intensityValue = document.getElementById('intensityValue');
                this.particleCountDisplay = document.getElementById('particleCount');
                this.currentEffectDisplay = document.getElementById('currentEffect');
                
                this.colorSchemes = [
                    {
                        name: 'Cosmic Flow',
                        colors: ['rgba(0, 150, 255, 0.6)', 'rgba(100, 50, 255, 0.8)', 'rgba(255, 100, 150, 0.7)', 'rgba(255, 200, 100, 0.6)']
                    },
                    {
                        name: 'Aurora Dreams',
                        colors: ['rgba(100, 255, 100, 0.6)', 'rgba(100, 255, 255, 0.8)', 'rgba(255, 100, 255, 0.7)', 'rgba(255, 255, 100, 0.6)']
                    },
                    {
                        name: 'Sunset Nebula',
                        colors: ['rgba(255, 100, 50, 0.6)', 'rgba(255, 150, 100, 0.8)', 'rgba(255, 200, 150, 0.7)', 'rgba(255, 255, 200, 0.6)']
                    },
                    {
                        name: 'Deep Space',
                        colors: ['rgba(50, 50, 150, 0.6)', 'rgba(100, 50, 200, 0.8)', 'rgba(150, 100, 255, 0.7)', 'rgba(200, 150, 255, 0.6)']
                    }
                ];
                
                this.initializeControls();
                this.createCosmicDust();
                this.startIdleAnimation();
            }

            initializeControls() {
                const audioBtn = document.getElementById('audioBtn');
                const musicBtn = document.getElementById('musicBtn');
                const effectBtn = document.getElementById('effectBtn');
                const colorBtn = document.getElementById('colorBtn');
                const settingsBtn = document.getElementById('settingsBtn');
                const fullscreenToggle = document.getElementById('fullscreenToggle');

                audioBtn.addEventListener('click', () => this.toggleAudio());
                musicBtn.addEventListener('click', () => this.toggleMusic());
                effectBtn.addEventListener('click', () => this.cycleEffects());
                colorBtn.addEventListener('click', () => this.cycleColors());
                settingsBtn.addEventListener('click', () => this.showSettings());
                fullscreenToggle.addEventListener('click', () => this.toggleFullscreen());

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    switch(e.key.toLowerCase()) {
                        case ' ':
                            e.preventDefault();
                            this.toggleAudio();
                            break;
                        case 'm':
                            this.toggleMusic();
                            break;
                        case 'e':
                            this.cycleEffects();
                            break;
                        case 'c':
                            this.cycleColors();
                            break;
                        case 'f':
                            this.toggleFullscreen();
                            break;
                    }
                });
            }

            async toggleAudio() {
                const audioBtn = document.getElementById('audioBtn');
                
                if (!this.isListening) {
                    try {
                        await this.startAudioVisualization();
                        audioBtn.classList.add('active');
                        this.isListening = true;
                        this.audioStatus.textContent = 'Active';
                        this.showNotification('üé§ Audio visualization activated');
                    } catch (error) {
                        console.error('Microphone access denied:', error);
                        this.showNotification('‚ùå Microphone access required');
                    }
                } else {
                    this.stopAudioVisualization();
                    audioBtn.classList.remove('active');
                    this.isListening = false;
                    this.audioStatus.textContent = 'Inactive';
                    this.showNotification('üé§ Audio visualization stopped');
                }
            }

            async startAudioVisualization() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    
                    const stream = await navigator.mediaDevices.getUserMedia({ 
                        audio: {
                            echoCancellation: true,
                            noiseSuppression: true,
                            autoGainControl: true
                        }
                    });
                    
                    this.microphone = this.audioContext.createMediaStreamSource(stream);
                    this.analyser = this.audioContext.createAnalyser();
                    this.analyser.fftSize = 512;
                    this.analyser.smoothingTimeConstant = 0.8;
                    
                    this.microphone.connect(this.analyser);
                    this.dataArray = new Uint8Array(this.analyser.frequencyBinCount);
                    
                    this.animateNebula();
                } catch (error) {
                    throw error;
                }
            }

            stopAudioVisualization() {
                if (this.animationId) {
                    cancelAnimationFrame(this.animationId);
                }
                
                if (this.audioContext) {
                    this.audioContext.close();
                    this.audioContext = null;
                }
            }

            animateNebula() {
                if (!this.analyser || !this.isListening) return;
                
                this.analyser.getByteFrequencyData(this.dataArray);
                
                // Calculate overall intensity
                const totalIntensity = this.dataArray.reduce((sum, value) => sum + value, 0);
                const normalizedIntensity = totalIntensity / (this.dataArray.length * 255);
                
                // Update intensity indicator
                this.intensityBar.style.height = (normalizedIntensity * 100) + '%';
                this.intensityValue.textContent = Math.round(normalizedIntensity * 100) + '%';
                
                // Create audio-reactive waves
                if (normalizedIntensity > 0.1) {
                    this.createAudioWave(normalizedIntensity);
                }
                
                // Modify existing waves based on frequency data
                this.modifyExistingWaves(normalizedIntensity);
                
                // Create particles based on intensity
                if (normalizedIntensity > 0.3) {
                    this.createCosmicParticles(normalizedIntensity);
                }
                
                this.animationId = requestAnimationFrame(() => this.animateNebula());
            }

            createAudioWave(intensity) {
                const wave = document.createElement('div');
                wave.className = 'audio-wave';
                
                const size = 200 + intensity * 400;
                wave.style.width = size + 'px';
                wave.style.height = size + 'px';
                wave.style.left = Math.random() * (window.innerWidth - size) + 'px';
                wave.style.top = Math.random() * (window.innerHeight - size) + 'px';
                
                const colors = this.colorSchemes[this.currentColorScheme].colors;
                const color = colors[Math.floor(Math.random() * colors.length)];
                wave.style.background = `radial-gradient(circle, ${color} 0%, transparent 70%)`;
                wave.style.opacity = intensity;
                wave.style.animationDuration = (3 - intensity * 2) + 's';
                
                this.nebulaContainer.appendChild(wave);
                
                setTimeout(() => {
                    if (wave.parentNode) {
                        wave.parentNode.removeChild(wave);
                    }
                }, 3000);
            }

            modifyExistingWaves(intensity) {
                const waves = document.querySelectorAll('.cosmic-wave');
                waves.forEach((wave, index) => {
                    const scale = 1 + intensity * 0.3;
                    const rotation = intensity * 10;
                    wave.style.transform = `scale(${scale}) rotate(${rotation}deg)`;
                    wave.style.opacity = 0.6 + intensity * 0.4;
                });
                
                const orbs = document.querySelectorAll('.energy-orb');
                orbs.forEach((orb, index) => {
                    const scale = 1 + intensity * 0.5;
                    orb.style.transform = `scale(${scale})`;
                    orb.style.opacity = 0.6 + intensity * 0.4;
                });
            }

            createCosmicParticles(intensity) {
                const particleCount = Math.floor(intensity * 10);
                
                for (let i = 0; i < particleCount; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'cosmic-dust';
                    
                    const colors = ['rgba(255, 255, 255, 0.8)', 'rgba(100, 150, 255, 0.6)', 'rgba(255, 100, 150, 0.6)', 'rgba(255, 200, 100, 0.6)'];
                    particle.style.background = colors[Math.floor(Math.random() * colors.length)];
                    particle.style.left = Math.random() * window.innerWidth + 'px';
                    particle.style.top = window.innerHeight + 'px';
                    particle.style.animationDuration = (5 + Math.random() * 3) + 's';
                    particle.style.animationDelay = Math.random() * 2 + 's';
                    
                    document.body.appendChild(particle);
                    this.particleCount++;
                    
                    setTimeout(() => {
                        if (particle.parentNode) {
                            particle.parentNode.removeChild(particle);
                            this.particleCount--;
                        }
                    }, 8000);
                }
                
                this.particleCountDisplay.textContent = this.particleCount;
            }

            toggleMusic() {
                const musicBtn = document.getElementById('musicBtn');
                
                if (!this.isMusicMode) {
                    this.startMusicMode();
                    musicBtn.classList.add('active');
                    this.isMusicMode = true;
                    this.musicStatus.textContent = 'Active';
                    this.showNotification('üéµ Music visualization mode activated');
                } else {
                    this.stopMusicMode();
                    musicBtn.classList.remove('active');
                    this.isMusicMode = false;
                    this.musicStatus.textContent = 'Ready';
                    this.showNotification('üéµ Music mode stopped');
                }
            }

            startMusicMode() {
                // Simulate music frequency data
                this.musicInterval = setInterval(() => {
                    const intensity = 0.3 + Math.random() * 0.7;
                    this.intensityBar.style.height = (intensity * 100) + '%';
                    this.intensityValue.textContent = Math.round(intensity * 100) + '%';
                    
                    this.createAudioWave(intensity);
                    this.modifyExistingWaves(intensity);
                    
                    if (intensity > 0.5) {
                        this.createCosmicParticles(intensity);
                    }
                }, 100);
            }

            stopMusicMode() {
                if (this.musicInterval) {
                    clearInterval(this.musicInterval);
                }
            }

            cycleEffects() {
                const effects = ['cosmic', 'aurora', 'plasma', 'quantum'];
                const currentIndex = effects.indexOf(this.currentEffect);
                this.currentEffect = effects[(currentIndex + 1) % effects.length];
                
                this.applyEffect(this.currentEffect);
                this.currentEffectDisplay.textContent = this.currentEffect.charAt(0).toUpperCase() + this.currentEffect.slice(1);
                this.showNotification(`‚ö° Effect: ${this.currentEffect.charAt(0).toUpperCase() + this.currentEffect.slice(1)}`);
            }

            applyEffect(effect) {
                const waves = document.querySelectorAll('.cosmic-wave');
                
                switch(effect) {
                    case 'cosmic':
                        waves.forEach(wave => {
                            wave.style.filter = 'blur(40px)';
                            wave.style.mixBlendMode = 'screen';
                        });
                        break;
                    case 'aurora':
                        waves.forEach(wave => {
                            wave.style.filter = 'blur(30px) hue-rotate(45deg)';
                            wave.style.mixBlendMode = 'lighten';
                        });
                        break;
                    case 'plasma':
                        waves.forEach(wave => {
                            wave.style.filter = 'blur(20px) saturate(2)';
                            wave.style.mixBlendMode = 'color-dodge';
                        });
                        break;
                    case 'quantum':
                        waves.forEach(wave => {
                            wave.style.filter = 'blur(50px) contrast(1.5)';
                            wave.style.mixBlendMode = 'multiply';
                        });
                        break;
                }
            }

            cycleColors() {
                this.currentColorScheme = (this.currentColorScheme + 1) % this.colorSchemes.length;
                const scheme = this.colorSchemes[this.currentColorScheme];
                
                this.applyColorScheme(scheme);
                this.showNotification(`üé® Color: ${scheme.name}`);
            }

            applyColorScheme(scheme) {
                const waves = document.querySelectorAll('.cosmic-wave');
                waves.forEach((wave, index) => {
                    const color = scheme.colors[index % scheme.colors.length];
                    if (wave.classList.contains('wave-primary')) {
                        wave.style.background = `linear-gradient(45deg, ${scheme.colors[0]}, ${scheme.colors[1]}, ${scheme.colors[2]}, ${scheme.colors[3]})`;
                    } else if (wave.classList.contains('wave-secondary')) {
                        wave.style.background = `linear-gradient(-45deg, ${scheme.colors[1]}, ${scheme.colors[2]}, ${scheme.colors[0]})`;
                    } else if (wave.classList.contains('wave-tertiary')) {
                        wave.style.background = `radial-gradient(ellipse at center, ${scheme.colors[2]} 0%, ${scheme.colors[3]} 30%, ${scheme.colors[0]} 60%, transparent 100%)`;
                    }
                });
            }

            createCosmicDust() {
                const createDust = () => {
                    const dust = document.createElement('div');
                    dust.className = 'cosmic-dust';
                    
                    const colors = ['rgba(255, 255, 255, 0.7)', 'rgba(100, 150, 255, 0.5)', 'rgba(255, 100, 150, 0.5)', 'rgba(255, 200, 100, 0.5)'];
                    dust.style.background = colors[Math.floor(Math.random() * colors.length)];
                    dust.style.left = Math.random() * window.innerWidth + 'px';
                    dust.style.top = window.innerHeight + 10 + 'px';
                    dust.style.animationDuration = (6 + Math.random() * 4) + 's';
                    dust.style.animationDelay = Math.random() * 3 + 's';
                    
                    document.body.appendChild(dust);
                    this.particleCount++;
                    
                    setTimeout(() => {
                        if (dust.parentNode) {
                            dust.parentNode.removeChild(dust);
                            this.particleCount--;
                        }
                    }, 10000);
                };
                
                // Create dust particles periodically
                setInterval(createDust, 500);
                
                // Initial dust
                for (let i = 0; i < 10; i++) {
                    setTimeout(createDust, i * 200);
                }
            }

            startIdleAnimation() {
                let time = 0;
                
                const animate = () => {
                    if (!this.isListening && !this.isMusicMode) {
                        const waves = document.querySelectorAll('.cosmic-wave');
                        waves.forEach((wave, index) => {
                            const scale = 1 + Math.sin(time + index * 0.5) * 0.1;
                            const rotation = Math.sin(time + index * 0.3) * 5;
                            wave.style.transform = `scale(${scale}) rotate(${rotation}deg)`;
                        });
                        
                        const orbs = document.querySelectorAll('.energy-orb');
                        orbs.forEach((orb, index) => {
                            const scale = 1 + Math.sin(time + index * 0.7) * 0.2;
                            orb.style.transform = `scale(${scale})`;
                        });
                        
                        time += 0.01;
                    }
                    
                    this.particleCountDisplay.textContent = this.particleCount;
                    
                    requestAnimationFrame(animate);
                };
                
                animate();
            }

            toggleFullscreen() {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen().then(() => {
                        this.showNotification('üîç Fullscreen mode activated');
                    });
                } else {
                    document.exitFullscreen().then(() => {
                        this.showNotification('üîç Fullscreen mode deactivated');
                    });
                }
            }

            showSettings() {
                this.showNotification('‚öôÔ∏è Settings panel coming soon...');
            }

            showNotification(message) {
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(0, 0, 0, 0.8);
                    color: white;
                    padding: 20px 30px;
                    border-radius: 15px;
                    font-size: 16px;
                    z-index: 2000;
                    backdrop-filter: blur(15px);
                    border: 1px solid rgba(255, 255, 255, 0.3);
                    box-shadow: 0 0 30px rgba(100, 150, 255, 0.3);
                    transition: all 0.3s ease;
                `;
                
                notification.textContent = message;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.opacity = '0';
                    notification.style.transform = 'translate(-50%, -50%) scale(0.9)';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }, 2000);
            }
        }

        // Initialize the visualizer
        document.addEventListener('DOMContentLoaded', () => {
            window.cosmicVisualizer = new CosmicNebulaVisualizer();
            
            // Add loading screen fade out
            setTimeout(() => {
                document.body.style.opacity = '1';
            }, 100);
        });

        // Handle window resize
        window.addEventListener('resize', () => {
            if (window.cosmicVisualizer) {
                // Recreate particles on resize
                window.cosmicVisualizer.createCosmicDust();
            }
        });

        // Handle visibility changes
        document.addEventListener('visibilitychange', () => {
            if (document.hidden && window.cosmicVisualizer) {
                if (window.cosmicVisualizer.isListening) {
                    window.cosmicVisualizer.toggleAudio();
                }
                if (window.cosmicVisualizer.isMusicMode) {
                    window.cosmicVisualizer.toggleMusic();
                }
            }
        });
    </script>
</body>
</html>
