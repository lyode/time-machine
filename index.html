<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="REFIT MAINTENANCE SERVICES">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#FFB07A">
    <meta name="msapplication-navbutton-color" content="#FFB07A">
    
    <title>REFIT MAINTENANCE SERVICES - Pastel Orange Theme</title>
    
    <!-- Enhanced PDF Generation Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        input, select, textarea, button {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }
        
        :root {
            /* Pastel Orange Theme - Light Mode */
            --bg-primary: #fef9f6;
            --bg-secondary: #fff1ea;
            --bg-card: #ffffff;
            --bg-card-hover: #fef7f2;
            --text-primary: #2d3748;
            --text-secondary: #4a5568;
            --text-muted: #718096;
            
            /* Pastel Orange Button Colors */
            --accent-primary: #FFB07A;
            --accent-secondary: #FFA366;
            --accent-warm: #FF8C42;
            --accent-soft: #FFD4B3;
            --accent-light: #FFF2E6;
            --accent-dark: #E69660;
            
            --border-color: #e2e8f0;
            --shadow-light: rgba(255, 176, 122, 0.15);
            --shadow-medium: rgba(255, 176, 122, 0.25);
            --shadow-strong: rgba(255, 176, 122, 0.35);
            --overlay: rgba(45, 55, 72, 0.8);
            
            /* Status Colors with Orange Tints */
            --success: #FFB07A;
            --warning: #FF8C42;
            --error: #FF6B42;
            --info: #FFA366;
            
            /* Enhanced Category Colors - Pastel Orange Variations */
            --cat-electrical: #FFB07A;
            --cat-plumbing: #FFA366;
            --cat-hvac: #FF8C42;
            --cat-cleaning: #FFD4B3;
            --cat-parts: #E69660;
            --cat-labor: #FF6B42;
            --cat-equipment: #FFCC99;
            --cat-common: #FFE5CC;
            --cat-preliminary: #FF7F50;
            --cat-wall: #FFB366;
            --cat-floor: #FFC299;
            --cat-ceiling: #FFD1B3;
            --cat-roofing: #FF9966;
            --cat-wetwork: #FFE0CC;
            --cat-me-work: #FF8566;
            --cat-exhaust: #FFAD80;
            --cat-lights-fan: #FFC499;
            --cat-ac: #FFD699;
            --cat-paint: #FFE8D9;
            --cat-curtain: #FFB88A;
            --cat-builtin: #FFC7A3;
            --cat-loose: #FFD6B6;
            --cat-sanitary: #FFE5C9;
            --cat-appliances: #FFF4DC;
        }
        
        [data-theme="dark"] {
            /* Pastel Orange Theme - Dark Mode */
            --bg-primary: #1a1411;
            --bg-secondary: #2d241f;
            --bg-card: #3a2f29;
            --bg-card-hover: #453a33;
            --text-primary: #f7e6d7;
            --text-secondary: #e0c4a8;
            --text-muted: #c4a285;
            
            /* Pastel Orange Button Colors - Dark Mode */
            --accent-primary: #FFB07A;
            --accent-secondary: #FFA366;
            --accent-warm: #FF8C42;
            --accent-soft: #CC8A61;
            --accent-light: #B87A56;
            --accent-dark: #E69660;
            
            --border-color: #4a3a2f;
            --shadow-light: rgba(255, 176, 122, 0.1);
            --shadow-medium: rgba(255, 176, 122, 0.2);
            --shadow-strong: rgba(255, 176, 122, 0.3);
            --overlay: rgba(0, 0, 0, 0.9);
            
            /* Status Colors - Dark Mode */
            --success: #FFB07A;
            --warning: #FF8C42;
            --error: #FF6B42;
            --info: #FFA366;
            
            /* Category Colors - Dark Mode with Orange Tints */
            --cat-electrical: #CC8A61;
            --cat-plumbing: #B87A56;
            --cat-hvac: #CC7A42;
            --cat-cleaning: #E6A875;
            --cat-parts: #B8704D;
            --cat-labor: #CC5B42;
            --cat-equipment: #E6B485;
            --cat-common: #F0C794;
            --cat-preliminary: #CC6B50;
            --cat-wall: #CC8F66;
            --cat-floor: #E6A885;
            --cat-ceiling: #F0BFA3;
            --cat-roofing: #CC7F66;
            --cat-wetwork: #F0C2AC;
            --cat-me-work: #CC7566;
            --cat-exhaust: #E69B80;
            --cat-lights-fan: #E6AA85;
            --cat-ac: #F0BC94;
            --cat-paint: #F5D4C4;
            --cat-curtain: #E69E80;
            --cat-builtin: #E6B394;
            --cat-loose: #F0C2A3;
            --cat-sanitary: #F5D1BC;
            --cat-appliances: #FAE0D1;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
            font-size: 16px;
            line-height: 1.6;
            transition: all 0.3s ease;
        }
        
        /* Mobile Layout Container */
        .mobile-container {
            position: relative;
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: var(--bg-primary);
        }
        
        /* Status Bar */
        .status-bar {
            height: 44px;
            background: var(--bg-secondary);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            font-size: 14px;
            font-weight: 600;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            backdrop-filter: blur(20px);
            box-shadow: 0 2px 10px var(--shadow-medium);
            border-bottom: 1px solid var(--border-color);
        }
        
        .status-bar .time {
            color: var(--text-primary);
        }
        
        .status-bar .indicators {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
        }
        
        .theme-toggle {
            background: var(--accent-primary);
            border: none;
            border-radius: 12px;
            padding: 6px 12px;
            font-size: 12px;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 600;
            box-shadow: 0 2px 8px var(--shadow-light);
        }
        
        .theme-toggle:hover {
            background: var(--accent-secondary);
            transform: scale(1.05);
            box-shadow: 0 4px 12px var(--shadow-medium);
        }
        
        /* Header */
        .header {
            background: var(--bg-secondary);
            backdrop-filter: blur(30px);
            border-bottom: 1px solid var(--border-color);
            padding: 16px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: fixed;
            top: 44px;
            left: 0;
            right: 0;
            z-index: 90;
            box-shadow: 0 4px 20px var(--shadow-medium);
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .app-logo {
            width: 54px;
            height: 54px;
            background: var(--accent-primary);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
            box-shadow: 0 6px 16px var(--shadow-medium);
            color: white;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            overflow: hidden;
            position: relative;
            border: 2px solid var(--accent-secondary);
        }
        
        .app-logo:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px var(--shadow-strong);
            background: var(--accent-secondary);
        }
        
        .app-logo:active {
            transform: scale(0.95);
        }
        
        .logo-svg {
            width: 32px;
            height: 32px;
            filter: drop-shadow(0 2px 4px var(--shadow-light));
        }
        
        .user-logo {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 14px;
        }
        
        .app-title h1 {
            font-size: 18px;
            font-weight: 700;
            line-height: 1.1;
            letter-spacing: -0.5px;
            margin-bottom: 2px;
            color: var(--text-primary);
        }
        
        .app-title p {
            font-size: 11px;
            color: var(--text-secondary);
            font-weight: 500;
            line-height: 1.2;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .header-right .stats {
            text-align: right;
        }
        
        .header-right p {
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 600;
        }
        
        .header-btn {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            border: none;
            background: var(--accent-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 18px;
            box-shadow: 0 2px 8px var(--shadow-light);
            margin-left: 8px;
        }
        
        .header-btn:hover {
            background: var(--accent-secondary);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow-medium);
        }
        
        .header-btn:active {
            transform: scale(0.9);
        }
        
        .header-btn.user-info {
            background: var(--accent-warm);
        }
        
        .header-btn.icon-upload {
            background: var(--accent-soft);
            color: var(--text-primary);
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            overflow-y: auto;
            padding: 130px 20px 140px;
            -webkit-overflow-scrolling: touch;
            position: relative;
            height: calc(100vh - 44px);
            scroll-behavior: smooth;
        }
        
        .main-content::-webkit-scrollbar {
            width: 6px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: var(--bg-secondary);
            border-radius: 3px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: var(--accent-primary);
            border-radius: 3px;
        }
        
        /* Category System */
        .category-badge {
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: white;
            display: inline-block;
            margin-right: 6px;
        }
        
        /* Enhanced Category Classes */
        .category-electrical { background: var(--cat-electrical); }
        .category-plumbing { background: var(--cat-plumbing); }
        .category-hvac { background: var(--cat-hvac); }
        .category-cleaning { background: var(--cat-cleaning); }
        .category-parts { background: var(--cat-parts); }
        .category-labor { background: var(--cat-labor); }
        .category-equipment { background: var(--cat-equipment); }
        .category-common { background: var(--cat-common); }
        .category-preliminary { background: var(--cat-preliminary); }
        .category-wall { background: var(--cat-wall); }
        .category-floor { background: var(--cat-floor); }
        .category-ceiling { background: var(--cat-ceiling); }
        .category-roofing { background: var(--cat-roofing); }
        .category-wetwork { background: var(--cat-wetwork); }
        .category-me-work { background: var(--cat-me-work); }
        .category-exhaust { background: var(--cat-exhaust); }
        .category-lights-fan { background: var(--cat-lights-fan); }
        .category-ac { background: var(--cat-ac); }
        .category-paint { background: var(--cat-paint); }
        .category-curtain { background: var(--cat-curtain); }
        .category-builtin { background: var(--cat-builtin); }
        .category-loose { background: var(--cat-loose); }
        .category-sanitary { background: var(--cat-sanitary); }
        .category-appliances { background: var(--cat-appliances); }
        
        .category-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
            padding: 16px;
            background: var(--bg-card);
            border-radius: 16px;
            border: 1px solid var(--border-color);
            max-height: 200px;
            overflow-y: auto;
        }
        
        .category-filter {
            padding: 8px 16px;
            border-radius: 20px;
            border: 2px solid var(--accent-soft);
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .category-filter:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow-light);
            border-color: var(--accent-primary);
        }
        
        .category-filter.active {
            border-color: var(--accent-primary);
            background: var(--accent-primary);
            color: white;
        }
        
        .category-count {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 10px;
            margin-left: 4px;
        }
        
        /* Category Sections */
        .category-section {
            margin-bottom: 24px;
            border-radius: 16px;
            overflow: hidden;
            border: 2px solid var(--border-color);
            transition: all 0.2s ease;
        }
        
        .category-header {
            padding: 16px 20px;
            background: var(--bg-secondary);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
        }
        
        .category-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 700;
            font-size: 16px;
            color: var(--text-primary);
        }
        
        .category-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
        }
        
        .category-icon.electrical { background: var(--cat-electrical); }
        .category-icon.plumbing { background: var(--cat-plumbing); }
        .category-icon.hvac { background: var(--cat-hvac); }
        .category-icon.cleaning { background: var(--cat-cleaning); }
        .category-icon.parts { background: var(--cat-parts); }
        .category-icon.labor { background: var(--cat-labor); }
        .category-icon.equipment { background: var(--cat-equipment); }
        .category-icon.common { background: var(--cat-common); }
        .category-icon.preliminary { background: var(--cat-preliminary); }
        .category-icon.wall { background: var(--cat-wall); }
        .category-icon.floor { background: var(--cat-floor); }
        .category-icon.ceiling { background: var(--cat-ceiling); }
        .category-icon.roofing { background: var(--cat-roofing); }
        .category-icon.wetwork { background: var(--cat-wetwork); }
        .category-icon.me-work { background: var(--cat-me-work); }
        .category-icon.exhaust { background: var(--cat-exhaust); }
        .category-icon.lights-fan { background: var(--cat-lights-fan); }
        .category-icon.ac { background: var(--cat-ac); }
        .category-icon.paint { background: var(--cat-paint); }
        .category-icon.curtain { background: var(--cat-curtain); }
        .category-icon.builtin { background: var(--cat-builtin); }
        .category-icon.loose { background: var(--cat-loose); }
        .category-icon.sanitary { background: var(--cat-sanitary); }
        .category-icon.appliances { background: var(--cat-appliances); }
        
        /* Custom Icon Display */
        .custom-icon {
            width: 24px;
            height: 24px;
            object-fit: cover;
            border-radius: 4px;
        }
        
        .category-stats {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 12px;
            color: var(--text-muted);
        }
        
        .category-body {
            background: var(--bg-card);
        }
        
        /* Cards */
        .card {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 24px;
            margin: 20px 0;
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 32px var(--shadow-light);
            transition: all 0.2s ease;
        }
        
        .card:hover {
            box-shadow: 0 12px 40px var(--shadow-medium);
            transform: translateY(-2px);
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border-radius: 18px;
            padding: 20px 16px;
            text-align: center;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 16px var(--shadow-light);
            transition: all 0.2s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px var(--shadow-medium);
        }
        
        .stat-label {
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 8px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: 800;
            line-height: 1;
            color: var(--accent-primary);
        }
        
        /* Buttons - All Pastel Orange */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 16px 24px;
            border-radius: 16px;
            border: none;
            color: white;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 52px;
            text-decoration: none;
            box-shadow: 0 4px 12px var(--shadow-light);
            background: var(--accent-primary);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px var(--shadow-medium);
            background: var(--accent-secondary);
        }
        
        .btn:active {
            transform: scale(0.96);
        }
        
        .btn-primary { background: var(--accent-primary); }
        .btn-success { background: var(--accent-primary); }
        .btn-danger { background: var(--accent-warm); }
        .btn-warning { background: var(--accent-secondary); }
        .btn-info { background: var(--accent-soft); color: var(--text-primary); }
        .btn-soft { background: var(--accent-soft); color: var(--text-primary); }
        .btn-warm { background: var(--accent-warm); }
        .btn-secondary { background: var(--accent-dark); }
        
        /* Action Buttons */
        .actions-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }
        
        .action-btn {
            padding: 24px 20px;
            border-radius: 20px;
            border: none;
            color: white;
            font-weight: 600;
            font-size: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            transition: all 0.2s ease;
            cursor: pointer;
            min-height: 120px;
            box-shadow: 0 6px 20px var(--shadow-light);
        }
        
        .action-btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 30px var(--shadow-medium);
        }
        
        .action-btn:active {
            transform: scale(0.96);
        }
        
        .action-btn.primary { background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); }
        .action-btn.success { background: linear-gradient(135deg, var(--accent-primary), var(--accent-warm)); }
        .action-btn.warm { background: linear-gradient(135deg, var(--accent-warm), var(--accent-secondary)); }
        .action-btn.soft { background: linear-gradient(135deg, var(--accent-soft), var(--accent-primary)); }
        .action-btn.info { background: linear-gradient(135deg, var(--accent-secondary), var(--accent-dark)); }
        .action-btn.secondary { background: linear-gradient(135deg, var(--accent-dark), var(--accent-primary)); }
        
        .action-btn .icon {
            font-size: 32px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
        }
        
        /* Form Elements */
        .input {
            width: 100%;
            padding: 18px 20px;
            border-radius: 16px;
            border: 2px solid var(--border-color);
            background: var(--bg-card);
            color: var(--text-primary);
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 16px;
            transition: all 0.2s ease;
        }
        
        .input::placeholder {
            color: var(--text-muted);
        }
        
        .input:focus {
            outline: none;
            background: var(--bg-card);
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(255, 176, 122, 0.2);
        }
        
        /* File Upload Styles */
        .file-upload {
            position: relative;
            display: inline-block;
            cursor: pointer;
            overflow: hidden;
            border-radius: 12px;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            transition: all 0.2s ease;
        }
        
        .file-upload:hover {
            border-color: var(--accent-primary);
            transform: translateY(-2px);
        }
        
        .file-upload input[type="file"] {
            position: absolute;
            left: -9999px;
        }
        
        .file-upload-label {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            color: white;
            font-weight: 600;
            font-size: 14px;
            background: var(--accent-primary);
            border-radius: 10px;
            transition: all 0.2s ease;
        }
        
        .file-upload-label:hover {
            background: var(--accent-secondary);
        }
        
        .upload-preview {
            max-width: 100px;
            max-height: 100px;
            border-radius: 8px;
            margin-top: 8px;
            border: 1px solid var(--border-color);
        }
        
        /* Search Input */
        .search-container {
            position: relative;
            margin-bottom: 20px;
        }
        
        .search-icon {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 18px;
            color: var(--text-muted);
            pointer-events: none;
        }
        
        .search-container input {
            padding-left: 56px;
        }
        
        /* Item Cards */
        .item-card {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 16px;
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 32px var(--shadow-light);
            transition: all 0.2s ease;
            position: relative;
        }
        
        .item-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px var(--shadow-medium);
            background: var(--bg-card-hover);
        }
        
        .item-card:active {
            transform: scale(0.98);
        }
        
        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }
        
        .item-info h3 {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 8px;
            line-height: 1.2;
            color: var(--text-primary);
        }
        
        /* Icon Buttons */
        .icon-btn {
            width: 44px;
            height: 44px;
            border-radius: 14px;
            border: none;
            background: var(--accent-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 16px;
            box-shadow: 0 2px 8px var(--shadow-light);
        }
        
        .icon-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow-medium);
            background: var(--accent-secondary);
        }
        
        .icon-btn:active {
            transform: scale(0.9);
        }
        
        .icon-btn.edit-btn { background: var(--accent-primary); }
        .icon-btn.delete-btn { background: var(--accent-warm); }
        .icon-btn.pdf-btn { background: var(--accent-secondary); }
        .icon-btn.quote-btn { background: var(--accent-soft); color: var(--text-primary); }
        
        .item-actions {
            display: flex;
            gap: 8px;
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 10;
        }
        
        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            backdrop-filter: blur(30px);
            border-top: 1px solid var(--border-color);
            padding: 12px 20px 32px;
            z-index: 100;
            box-shadow: 0 -4px 20px var(--shadow-medium);
        }
        
        .nav-items {
            display: flex;
            justify-content: space-around;
            align-items: center;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            padding: 12px 16px;
            border-radius: 16px;
            color: var(--text-muted);
            text-decoration: none;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s ease;
            cursor: pointer;
            min-width: 60px;
        }
        
        .nav-item.active {
            color: var(--accent-primary);
            background: var(--accent-light);
            box-shadow: 0 2px 8px var(--shadow-light);
            transform: scale(1.05);
        }
        
        .nav-item:hover {
            color: var(--accent-primary);
            transform: translateY(-2px);
        }
        
        .nav-item:active {
            transform: scale(0.95);
        }
        
        .nav-item .icon {
            font-size: 24px;
        }
        
        .home-indicator {
            height: 4px;
            background: var(--accent-primary);
            border-radius: 2px;
            width: 140px;
            margin: 12px auto 0;
            opacity: 0.6;
        }
        
        /* Modals */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--overlay);
            display: none;
            align-items: flex-end;
            z-index: 200;
            animation: fadeIn 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .modal.show {
            display: flex;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        
        .modal-content {
            background: var(--bg-card);
            backdrop-filter: blur(30px);
            border-radius: 24px 24px 0 0;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            color: var(--text-primary);
            animation: slideUp 0.3s ease;
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
            border: 1px solid var(--border-color);
            box-shadow: 0 -8px 40px var(--shadow-strong);
        }
        
        .modal-header {
            position: sticky;
            top: 0;
            background: var(--bg-card);
            backdrop-filter: blur(30px);
            border-bottom: 1px solid var(--border-color);
            padding: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .close-btn {
            width: 40px;
            height: 40px;
            border-radius: 20px;
            border: none;
            background: var(--bg-secondary);
            color: var(--text-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 18px;
        }
        
        .close-btn:hover {
            background: var(--accent-warm);
            color: white;
            transform: scale(1.1);
        }
        
        .close-btn:active {
            transform: scale(0.9);
        }
        
        .modal-body {
            padding: 24px;
        }
        
        /* Form Elements in Modals */
        .form-input {
            width: 100%;
            padding: 18px 20px;
            border-radius: 16px;
            border: 2px solid var(--border-color);
            background: var(--bg-card);
            color: var(--text-primary);
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 16px;
            transition: all 0.2s ease;
        }
        
        .form-input::placeholder {
            color: var(--text-muted);
        }
        
        .form-input:focus {
            outline: none;
            background: var(--bg-card);
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(255, 176, 122, 0.2);
        }
        
        .form-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-top: 24px;
        }
        
        .form-btn {
            padding: 18px 24px;
            border-radius: 16px;
            border: none;
            color: white;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 56px;
            box-shadow: 0 4px 12px var(--shadow-light);
            background: var(--accent-primary);
        }
        
        .form-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px var(--shadow-medium);
            background: var(--accent-secondary);
        }
        
        .form-btn:active {
            transform: scale(0.96);
        }
        
        .form-btn.btn-primary { background: var(--accent-primary); }
        .form-btn.btn-secondary { background: var(--accent-dark); }
        .form-btn.btn-danger { background: var(--accent-warm); }
        
        /* Success Message */
        .success-message {
            position: fixed;
            top: 120px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--accent-primary);
            color: white;
            padding: 16px 24px;
            border-radius: 16px;
            font-weight: 600;
            box-shadow: 0 8px 32px var(--shadow-medium);
            z-index: 250;
            opacity: 0;
            transform: translateX(-50%) translateY(-20px);
            transition: all 0.3s ease;
            max-width: 90%;
            text-align: center;
        }
        
        .success-message.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
        
        /* Section Headers */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        
        .section-title {
            font-size: 28px;
            font-weight: 800;
            color: var(--text-primary);
        }
        
        .add-btn {
            width: 56px;
            height: 56px;
            border-radius: 28px;
            border: none;
            background: var(--accent-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 24px;
            box-shadow: 0 8px 24px var(--shadow-medium);
        }
        
        .add-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px var(--shadow-strong);
            background: var(--accent-secondary);
        }
        
        .add-btn:active {
            transform: scale(0.9);
        }
        
        /* Utility Classes */
        .hidden {
            display: none !important;
        }
        
        .view {
            padding-top: 20px;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }
        
        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.6;
        }
        
        /* Mobile Optimizations */
        @media screen and (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }
            
            .actions-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .form-actions {
                grid-template-columns: 1fr;
            }
            
            .item-actions {
                position: static;
                margin-top: 12px;
                justify-content: flex-end;
            }
            
            .item-card {
                padding-right: 20px;
            }
            
            .section-title {
                font-size: 24px;
            }
            
            .category-filters {
                max-height: 150px;
            }
        }
        
        /* Safe area adjustments */
        @supports (padding: max(0px)) {
            .status-bar {
                padding-top: env(safe-area-inset-top);
                height: calc(44px + env(safe-area-inset-top));
            }
            
            .bottom-nav {
                padding-bottom: calc(32px + env(safe-area-inset-bottom));
            }
        }
        
        /* Print styles */
        @media print {
            .status-bar,
            .bottom-nav,
            .modal {
                display: none !important;
            }
            
            body {
                background: white !important;
                color: black !important;
            }
        }
    </style>
</head>
<body class="comfort-mode" data-theme="light">
    <div class="mobile-container">
        <!-- Status Bar -->
        <div class="status-bar">
            <div class="time" id="status-time">9:41</div>
            <div class="indicators">
                <button class="theme-toggle" onclick="toggleTheme()" id="theme-toggle">üåô Dark</button>
                <span>üì∂</span>
                <span>üì±</span>
                <span>üîã</span>
            </div>
        </div>
        
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <div class="logo-container">
                    <div class="app-logo" onclick="openLogoSelector()" id="main-logo">
                        <!-- Default Professional Maintenance Tool Icon -->
                        <svg class="logo-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <path d="M20 65L35 50L30 45L45 30C50 25 60 25 65 30C70 35 70 45 65 50L50 65L45 60L30 75C25 80 15 80 10 75C5 70 5 60 10 55L20 65Z" fill="currentColor" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                            <path d="M70 20L80 30L75 35L85 45C87 47 87 51 85 53L75 63L70 58L60 68C58 70 54 70 52 68L42 58L47 53L37 43C35 41 35 37 37 35L47 25L52 30L62 20C64 18 68 18 70 20Z" fill="currentColor" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                            <circle cx="50" cy="50" r="8" fill="rgba(255,255,255,0.8)" stroke="currentColor" stroke-width="2"/>
                            <circle cx="50" cy="50" r="3" fill="currentColor"/>
                        </svg>
                    </div>
                    <div class="app-title">
                        <h1 id="company-name">REFIT MAINTENANCE SERVICES</h1>
                        <p id="company-registration">Registration No: 201803348973<br>(002894203-V)</p>
                    </div>
                </div>
            </div>
            <div class="header-right">
                <div class="stats">
                    <p id="current-date">Today</p>
                    <p id="daily-revenue">RM 0.00</p>
                </div>
                <button class="header-btn user-info" onclick="openUserInfo()" title="User Info & Logo">
                    üë§
                </button>
                <button class="header-btn icon-upload" onclick="openIconUpload()" title="Upload Category Icons">
                    üé®
                </button>
                <button class="header-btn" onclick="exportData()" title="Export Data">
                    üì§
                </button>
            </div>
        </div>

        <!-- User Info Modal -->
        <div id="user-info-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>üë§ User Info & Company Settings</h3>
                    <button class="close-btn" onclick="closeUserInfo()">‚úï</button>
                </div>
                <div class="modal-body">
                    <div class="card" style="margin-bottom: 20px;">
                        <h4 style="margin-bottom: 16px; color: var(--text-primary); font-weight: 700;">üè¢ Company Information</h4>
                        <input type="text" class="form-input" placeholder="Company Name" id="user-company-name">
                        <input type="text" class="form-input" placeholder="Registration Number" id="user-registration">
                        <input type="text" class="form-input" placeholder="Phone Number" id="user-phone">
                        <input type="text" class="form-input" placeholder="Email Address" id="user-email">
                        <textarea class="form-input" placeholder="Company Address" id="user-address" rows="3" style="resize: none;"></textarea>
                        <input type="text" class="form-input" placeholder="Website" id="user-website">
                    </div>

                    <div class="card" style="margin-bottom: 20px;">
                        <h4 style="margin-bottom: 16px; color: var(--text-primary); font-weight: 700;">üñºÔ∏è Company Logo Upload</h4>
                        <p style="font-size: 14px; color: var(--text-muted); margin-bottom: 12px;">Upload your company logo (PNG, JPG, GIF - Max 2MB)</p>
                        
                        <div class="file-upload">
                            <input type="file" id="logo-upload" accept="image/*" onchange="handleLogoUpload(event)">
                            <label for="logo-upload" class="file-upload-label">
                                <span>üìÅ</span>
                                <span>Choose Logo Image</span>
                            </label>
                        </div>
                        
                        <div id="logo-preview" style="margin-top: 12px; text-align: center;"></div>
                        
                        <div style="margin-top: 12px;">
                            <button type="button" onclick="removeCustomLogo()" class="btn btn-danger" style="width: 100%; font-size: 14px;">
                                üóëÔ∏è Remove Custom Logo
                            </button>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" onclick="saveUserInfo()" class="form-btn btn-primary">
                            ‚úÖ Save Info
                        </button>
                        <button type="button" onclick="closeUserInfo()" class="form-btn btn-secondary">
                            Cancel
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Icon Upload Modal -->
        <div id="icon-upload-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>üé® Upload Category Icons</h3>
                    <button class="close-btn" onclick="closeIconUpload()">‚úï</button>
                </div>
                <div class="modal-body">
                    <div class="card" style="margin-bottom: 20px;">
                        <h4 style="margin-bottom: 16px; color: var(--text-primary); font-weight: 700;">üìÇ Custom Category Icons</h4>
                        <p style="font-size: 14px; color: var(--text-muted); margin-bottom: 16px;">Upload custom icons for categories (PNG, JPG, SVG - Max 1MB each)</p>
                        
                        <div id="category-icon-list">
                            <!-- Category icon upload items will be populated here -->
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" onclick="resetAllIcons()" class="form-btn btn-danger">
                            üîÑ Reset All Icons
                        </button>
                        <button type="button" onclick="closeIconUpload()" class="form-btn btn-secondary">
                            Done
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content" id="main-content">
            <!-- Dashboard View -->
            <div id="dashboard-view" class="view">
                <!-- Stats -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Total Quotes</div>
                        <div class="stat-value" id="total-quotes-count">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Quote Items</div>
                        <div class="stat-value" id="total-items-count">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Today's Revenue</div>
                        <div class="stat-value" id="today-revenue">RM 0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Revenue</div>
                        <div class="stat-value" id="total-revenue">RM 0</div>
                    </div>
                </div>

                <!-- Performance Card -->
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <h3 style="font-weight: 700; font-size: 18px; color: var(--text-primary);">üìä Category Overview</h3>
                        <span style="font-size: 24px;">üìà</span>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; font-size: 14px;">
                        <div style="text-align: center;">
                            <div style="font-size: 28px; font-weight: 800; color: var(--accent-primary);" id="average-quote">RM 0</div>
                            <div style="color: var(--text-muted); font-weight: 600;">Average Quote</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 28px; font-weight: 800; color: var(--accent-warm);" id="total-categories">0</div>
                            <div style="color: var(--text-muted); font-weight: 600;">Active Categories</div>
                        </div>
                    </div>
                </div>

                <!-- Category Statistics -->
                <div class="card">
                    <h3 style="font-weight: 700; margin-bottom: 16px; font-size: 18px; color: var(--text-primary);">üìä Category Breakdown</h3>
                    <div id="category-stats-grid"></div>
                </div>

                <!-- Quick Actions -->
                <div class="card">
                    <h3 style="font-weight: 700; margin-bottom: 16px; font-size: 18px; color: var(--text-primary);">Quick Actions</h3>
                    <div class="actions-grid">
                        <button class="action-btn primary" onclick="openSimpleJobForm()">
                            <span class="icon">‚ûï</span>
                            <span style="font-weight: 700;">Create Job Quote</span>
                        </button>
                        <button class="action-btn success" onclick="showView('quotes')">
                            <span class="icon">üí∞</span>
                            <span style="font-weight: 700;">View All Quotes</span>
                        </button>
                        <button class="action-btn warm" onclick="openPresetManager()">
                            <span class="icon">üìã</span>
                            <span style="font-weight: 700;">Manage Presets</span>
                        </button>
                        <button class="action-btn info" onclick="exportData()">
                            <span class="icon">üì§</span>
                            <span style="font-weight: 700;">Export Data</span>
                        </button>
                    </div>
                </div>

                <!-- Recent Quotes -->
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <h3 style="font-weight: 700; font-size: 18px; color: var(--text-primary);">Recent Job Quotes</h3>
                        <button style="background: var(--accent-primary); border: none; color: white; font-size: 14px; cursor: pointer; font-weight: 600; padding: 6px 12px; border-radius: 8px;" onclick="showView('quotes')">View All</button>
                    </div>
                    <div id="recent-quotes"></div>
                </div>
            </div>

            <!-- Quotes View -->
            <div id="quotes-view" class="view hidden">
                <div class="section-header">
                    <h2 class="section-title">Job Quotes</h2>
                    <button class="add-btn" onclick="openSimpleJobForm()">
                        <span>‚ûï</span>
                    </button>
                </div>

                <div class="search-container">
                    <span class="search-icon">üîç</span>
                    <input type="text" class="input" placeholder="Search quotes..." id="quote-search">
                </div>

                <!-- Enhanced Category Filters -->
                <div class="category-filters">
                    <div class="category-filter active" onclick="filterQuotesByCategory('all')" data-category="all">
                        <span>üìã</span>
                        <span>All Quotes</span>
                        <span class="category-count" id="filter-count-all">0</span>
                    </div>
                    <!-- Construction Categories -->
                    <div class="category-filter preliminary" onclick="filterQuotesByCategory('preliminary')" data-category="preliminary">
                        <span id="icon-preliminary">üèóÔ∏è</span>
                        <span>Preliminary</span>
                        <span class="category-count" id="filter-count-preliminary">0</span>
                    </div>
                    <div class="category-filter wall" onclick="filterQuotesByCategory('wall')" data-category="wall">
                        <span id="icon-wall">üß±</span>
                        <span>Wall Work</span>
                        <span class="category-count" id="filter-count-wall">0</span>
                    </div>
                    <div class="category-filter floor" onclick="filterQuotesByCategory('floor')" data-category="floor">
                        <span id="icon-floor">üè¢</span>
                        <span>Floor Work</span>
                        <span class="category-count" id="filter-count-floor">0</span>
                    </div>
                    <div class="category-filter ceiling" onclick="filterQuotesByCategory('ceiling')" data-category="ceiling">
                        <span id="icon-ceiling">üè†</span>
                        <span>Ceiling Work</span>
                        <span class="category-count" id="filter-count-ceiling">0</span>
                    </div>
                    <div class="category-filter roofing" onclick="filterQuotesByCategory('roofing')" data-category="roofing">
                        <span id="icon-roofing">üèòÔ∏è</span>
                        <span>Roofing</span>
                        <span class="category-count" id="filter-count-roofing">0</span>
                    </div>
                    <div class="category-filter wetwork" onclick="filterQuotesByCategory('wetwork')" data-category="wetwork">
                        <span id="icon-wetwork">üíß</span>
                        <span>Wet Work</span>
                        <span class="category-count" id="filter-count-wetwork">0</span>
                    </div>
                    <!-- M&E Categories -->
                    <div class="category-filter me-work" onclick="filterQuotesByCategory('me-work')" data-category="me-work">
                        <span id="icon-me-work">‚öôÔ∏è</span>
                        <span>M&E Work</span>
                        <span class="category-count" id="filter-count-me-work">0</span>
                    </div>
                    <div class="category-filter exhaust" onclick="filterQuotesByCategory('exhaust')" data-category="exhaust">
                        <span id="icon-exhaust">üå™Ô∏è</span>
                        <span>Exhaust</span>
                        <span class="category-count" id="filter-count-exhaust">0</span>
                    </div>
                    <div class="category-filter lights-fan" onclick="filterQuotesByCategory('lights-fan')" data-category="lights-fan">
                        <span id="icon-lights-fan">üí°</span>
                        <span>Lights & Fan</span>
                        <span class="category-count" id="filter-count-lights-fan">0</span>
                    </div>
                    <div class="category-filter ac" onclick="filterQuotesByCategory('ac')" data-category="ac">
                        <span id="icon-ac">‚ùÑÔ∏è</span>
                        <span>AC Systems</span>
                        <span class="category-count" id="filter-count-ac">0</span>
                    </div>
                    <!-- Finishing Categories -->
                    <div class="category-filter paint" onclick="filterQuotesByCategory('paint')" data-category="paint">
                        <span id="icon-paint">üé®</span>
                        <span>Paint Works</span>
                        <span class="category-count" id="filter-count-paint">0</span>
                    </div>
                    <div class="category-filter curtain" onclick="filterQuotesByCategory('curtain')" data-category="curtain">
                        <span id="icon-curtain">ü™ü</span>
                        <span>Curtain & Blind</span>
                        <span class="category-count" id="filter-count-curtain">0</span>
                    </div>
                    <!-- Furniture Categories -->
                    <div class="category-filter builtin" onclick="filterQuotesByCategory('builtin')" data-category="builtin">
                        <span id="icon-builtin">üî®</span>
                        <span>Built-in Furniture</span>
                        <span class="category-count" id="filter-count-builtin">0</span>
                    </div>
                    <div class="category-filter loose" onclick="filterQuotesByCategory('loose')" data-category="loose">
                        <span id="icon-loose">ü™ë</span>
                        <span>Loose Furniture</span>
                        <span class="category-count" id="filter-count-loose">0</span>
                    </div>
                    <!-- Services Categories -->
                    <div class="category-filter sanitary" onclick="filterQuotesByCategory('sanitary')" data-category="sanitary">
                        <span id="icon-sanitary">üöø</span>
                        <span>Sanitary & Water Pump</span>
                        <span class="category-count" id="filter-count-sanitary">0</span>
                    </div>
                    <div class="category-filter appliances" onclick="filterQuotesByCategory('appliances')" data-category="appliances">
                        <span id="icon-appliances">üì∫</span>
                        <span>Electrical Appliances</span>
                        <span class="category-count" id="filter-count-appliances">0</span>
                    </div>
                    <!-- Legacy Categories -->
                    <div class="category-filter electrical" onclick="filterQuotesByCategory('electrical')" data-category="electrical">
                        <span id="icon-electrical">‚ö°</span>
                        <span>Electrical</span>
                        <span class="category-count" id="filter-count-electrical">0</span>
                    </div>
                    <div class="category-filter plumbing" onclick="filterQuotesByCategory('plumbing')" data-category="plumbing">
                        <span id="icon-plumbing">üîß</span>
                        <span>Plumbing</span>
                        <span class="category-count" id="filter-count-plumbing">0</span>
                    </div>
                    <div class="category-filter hvac" onclick="filterQuotesByCategory('hvac')" data-category="hvac">
                        <span id="icon-hvac">üå°Ô∏è</span>
                        <span>HVAC</span>
                        <span class="category-count" id="filter-count-hvac">0</span>
                    </div>
                    <div class="category-filter cleaning" onclick="filterQuotesByCategory('cleaning')" data-category="cleaning">
                        <span id="icon-cleaning">üßΩ</span>
                        <span>Cleaning</span>
                        <span class="category-count" id="filter-count-cleaning">0</span>
                    </div>
                    <div class="category-filter parts" onclick="filterQuotesByCategory('parts')" data-category="parts">
                        <span id="icon-parts">üî©</span>
                        <span>Parts</span>
                        <span class="category-count" id="filter-count-parts">0</span>
                    </div>
                    <div class="category-filter labor" onclick="filterQuotesByCategory('labor')" data-category="labor">
                        <span id="icon-labor">üë∑</span>
                        <span>Labor</span>
                        <span class="category-count" id="filter-count-labor">0</span>
                    </div>
                    <div class="category-filter equipment" onclick="filterQuotesByCategory('equipment')" data-category="equipment">
                        <span id="icon-equipment">üõ†Ô∏è</span>
                        <span>Equipment</span>
                        <span class="category-count" id="filter-count-equipment">0</span>
                    </div>
                    <div class="category-filter common" onclick="filterQuotesByCategory('common')" data-category="common">
                        <span id="icon-common">üè∑Ô∏è</span>
                        <span>Common</span>
                        <span class="category-count" id="filter-count-common">0</span>
                    </div>
                </div>

                <div id="quotes-list"></div>
            </div>

            <!-- Presets View -->
            <div id="presets-view" class="view hidden">
                <div class="section-header">
                    <h2 class="section-title">Preset Items</h2>
                    <button class="add-btn" onclick="openPresetItemForm()">
                        <span>‚ûï</span>
                    </button>
                </div>

                <div class="search-container">
                    <span class="search-icon">üîç</span>
                    <input type="text" class="input" placeholder="Search preset items..." id="preset-search">
                </div>

                <!-- Enhanced Category Filters for Presets -->
                <div class="category-filters">
                    <div class="category-filter active" onclick="filterPresetsByCategory('all')" data-category="all">
                        <span>üìã</span>
                        <span>All Items</span>
                        <span class="category-count" id="preset-filter-count-all">0</span>
                    </div>
                    <!-- Same categories as quotes -->
                    <div class="category-filter preliminary" onclick="filterPresetsByCategory('preliminary')" data-category="preliminary">
                        <span id="preset-icon-preliminary">üèóÔ∏è</span>
                        <span>Preliminary</span>
                        <span class="category-count" id="preset-filter-count-preliminary">0</span>
                    </div>
                    <div class="category-filter wall" onclick="filterPresetsByCategory('wall')" data-category="wall">
                        <span id="preset-icon-wall">üß±</span>
                        <span>Wall Work</span>
                        <span class="category-count" id="preset-filter-count-wall">0</span>
                    </div>
                    <div class="category-filter floor" onclick="filterPresetsByCategory('floor')" data-category="floor">
                        <span id="preset-icon-floor">üè¢</span>
                        <span>Floor Work</span>
                        <span class="category-count" id="preset-filter-count-floor">0</span>
                    </div>
                    <div class="category-filter ceiling" onclick="filterPresetsByCategory('ceiling')" data-category="ceiling">
                        <span id="preset-icon-ceiling">üè†</span>
                        <span>Ceiling Work</span>
                        <span class="category-count" id="preset-filter-count-ceiling">0</span>
                    </div>
                    <div class="category-filter roofing" onclick="filterPresetsByCategory('roofing')" data-category="roofing">
                        <span id="preset-icon-roofing">üèòÔ∏è</span>
                        <span>Roofing</span>
                        <span class="category-count" id="preset-filter-count-roofing">0</span>
                    </div>
                    <div class="category-filter wetwork" onclick="filterPresetsByCategory('wetwork')" data-category="wetwork">
                        <span id="preset-icon-wetwork">üíß</span>
                        <span>Wet Work</span>
                        <span class="category-count" id="preset-filter-count-wetwork">0</span>
                    </div>
                    <div class="category-filter me-work" onclick="filterPresetsByCategory('me-work')" data-category="me-work">
                        <span id="preset-icon-me-work">‚öôÔ∏è</span>
                        <span>M&E Work</span>
                        <span class="category-count" id="preset-filter-count-me-work">0</span>
                    </div>
                    <div class="category-filter exhaust" onclick="filterPresetsByCategory('exhaust')" data-category="exhaust">
                        <span id="preset-icon-exhaust">üå™Ô∏è</span>
                        <span>Exhaust</span>
                        <span class="category-count" id="preset-filter-count-exhaust">0</span>
                    </div>
                    <div class="category-filter lights-fan" onclick="filterPresetsByCategory('lights-fan')" data-category="lights-fan">
                        <span id="preset-icon-lights-fan">üí°</span>
                        <span>Lights & Fan</span>
                        <span class="category-count" id="preset-filter-count-lights-fan">0</span>
                    </div>
                    <div class="category-filter ac" onclick="filterPresetsByCategory('ac')" data-category="ac">
                        <span id="preset-icon-ac">‚ùÑÔ∏è</span>
                        <span>AC Systems</span>
                        <span class="category-count" id="preset-filter-count-ac">0</span>
                    </div>
                    <div class="category-filter paint" onclick="filterPresetsByCategory('paint')" data-category="paint">
                        <span id="preset-icon-paint">üé®</span>
                        <span>Paint Works</span>
                        <span class="category-count" id="preset-filter-count-paint">0</span>
                    </div>
                    <div class="category-filter curtain" onclick="filterPresetsByCategory('curtain')" data-category="curtain">
                        <span id="preset-icon-curtain">ü™ü</span>
                        <span>Curtain & Blind</span>
                        <span class="category-count" id="preset-filter-count-curtain">0</span>
                    </div>
                    <div class="category-filter builtin" onclick="filterPresetsByCategory('builtin')" data-category="builtin">
                        <span id="preset-icon-builtin">üî®</span>
                        <span>Built-in Furniture</span>
                        <span class="category-count" id="preset-filter-count-builtin">0</span>
                    </div>
                    <div class="category-filter loose" onclick="filterPresetsByCategory('loose')" data-category="loose">
                        <span id="preset-icon-loose">ü™ë</span>
                        <span>Loose Furniture</span>
                        <span class="category-count" id="preset-filter-count-loose">0</span>
                    </div>
                    <div class="category-filter sanitary" onclick="filterPresetsByCategory('sanitary')" data-category="sanitary">
                        <span id="preset-icon-sanitary">üöø</span>
                        <span>Sanitary & Water Pump</span>
                        <span class="category-count" id="preset-filter-count-sanitary">0</span>
                    </div>
                    <div class="category-filter appliances" onclick="filterPresetsByCategory('appliances')" data-category="appliances">
                        <span id="preset-icon-appliances">üì∫</span>
                        <span>Electrical Appliances</span>
                        <span class="category-count" id="preset-filter-count-appliances">0</span>
                    </div>
                    <div class="category-filter electrical" onclick="filterPresetsByCategory('electrical')" data-category="electrical">
                        <span id="preset-icon-electrical">‚ö°</span>
                        <span>Electrical</span>
                        <span class="category-count" id="preset-filter-count-electrical">0</span>
                    </div>
                    <div class="category-filter plumbing" onclick="filterPresetsByCategory('plumbing')" data-category="plumbing">
                        <span id="preset-icon-plumbing">üîß</span>
                        <span>Plumbing</span>
                        <span class="category-count" id="preset-filter-count-plumbing">0</span>
                    </div>
                    <div class="category-filter hvac" onclick="filterPresetsByCategory('hvac')" data-category="hvac">
                        <span id="preset-icon-hvac">üå°Ô∏è</span>
                        <span>HVAC</span>
                        <span class="category-count" id="preset-filter-count-hvac">0</span>
                    </div>
                    <div class="category-filter cleaning" onclick="filterPresetsByCategory('cleaning')" data-category="cleaning">
                        <span id="preset-icon-cleaning">üßΩ</span>
                        <span>Cleaning</span>
                        <span class="category-count" id="preset-filter-count-cleaning">0</span>
                    </div>
                    <div class="category-filter parts" onclick="filterPresetsByCategory('parts')" data-category="parts">
                        <span id="preset-icon-parts">üî©</span>
                        <span>Parts</span>
                        <span class="category-count" id="preset-filter-count-parts">0</span>
                    </div>
                    <div class="category-filter labor" onclick="filterPresetsByCategory('labor')" data-category="labor">
                        <span id="preset-icon-labor">üë∑</span>
                        <span>Labor</span>
                        <span class="category-count" id="preset-filter-count-labor">0</span>
                    </div>
                    <div class="category-filter equipment" onclick="filterPresetsByCategory('equipment')" data-category="equipment">
                        <span id="preset-icon-equipment">üõ†Ô∏è</span>
                        <span>Equipment</span>
                        <span class="category-count" id="preset-filter-count-equipment">0</span>
                    </div>
                    <div class="category-filter common" onclick="filterPresetsByCategory('common')" data-category="common">
                        <span id="preset-icon-common">üè∑Ô∏è</span>
                        <span>Common</span>
                        <span class="category-count" id="preset-filter-count-common">0</span>
                    </div>
                </div>

                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <h3 style="font-weight: 700; color: var(--text-primary);">üìä Preset Statistics</h3>
                        <span style="background: var(--bg-secondary); padding: 4px 8px; border-radius: 8px; font-size: 12px; font-weight: 600; color: var(--text-primary);" id="preset-count">0 items</span>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; font-size: 14px;">
                        <div style="text-align: center;">
                            <div style="color: var(--text-muted);">Categories</div>
                            <div style="font-weight: 700; color: var(--accent-primary);" id="category-count">0</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="color: var(--text-muted);">Avg Price</div>
                            <div style="font-weight: 700; color: var(--accent-warm);" id="avg-preset-price">RM 0</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="color: var(--text-muted);">Usage</div>
                            <div style="font-weight: 700; color: var(--text-primary);" id="preset-usage-count">0</div>
                        </div>
                    </div>
                </div>

                <div id="presets-list"></div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <div class="nav-items">
                <div class="nav-item active" onclick="showView('dashboard')">
                    <span class="icon">üè†</span>
                    <span>Home</span>
                </div>
                <div class="nav-item" onclick="showView('quotes')">
                    <span class="icon">üí∞</span>
                    <span>Quotes</span>
                </div>
                <div class="nav-item" onclick="showView('presets')">
                    <span class="icon">üìã</span>
                    <span>Presets</span>
                </div>
            </div>
            <div class="home-indicator"></div>
        </div>
    </div>

    <!-- Simple Job Form Modal -->
    <div id="simple-job-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="simple-job-modal-title">üí∞ Create Job Quote</h3>
                <button class="close-btn" onclick="closeSimpleJobForm()">‚úï</button>
            </div>
            <div class="modal-body">
                <!-- Job Title Section -->
                <div class="card" style="margin-bottom: 20px;">
                    <h4 style="color: var(--text-primary); margin-bottom: 16px; font-weight: 700; display: flex; align-items: center; gap: 8px;">
                        üìù Job Details
                    </h4>
                    <input type="text" class="form-input" placeholder="Job Title/Description *" id="simple-job-title" required style="margin-bottom: 0;">
                </div>

                <!-- Preset Items Section with Enhanced Categories -->
                <div style="background: var(--bg-card); border-radius: 16px; padding: 24px; margin: 20px 0; border: 2px solid var(--accent-primary); box-shadow: 0 8px 32px var(--shadow-light);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <h4 style="font-size: 18px; font-weight: 700; color: var(--text-primary); display: flex; align-items: center; gap: 8px;">
                            üìã Quick Add Items
                        </h4>
                        <button type="button" onclick="openPresetItemForm()" class="btn btn-primary" style="padding: 6px 12px; font-size: 12px;">
                            ‚ûï New Preset
                        </button>
                    </div>
                    
                    <!-- Enhanced Category Selector for Presets -->
                    <div style="margin-bottom: 16px;">
                        <select id="preset-category-selector" class="form-input" style="margin-bottom: 0; padding: 12px 16px; font-size: 14px;" onchange="filterPresetItemsInModal()">
                            <option value="all">All Categories</option>
                            <optgroup label="Construction">
                                <option value="preliminary">üèóÔ∏è Preliminary Work</option>
                                <option value="wall">üß± Wall Work</option>
                                <option value="floor">üè¢ Floor Work</option>
                                <option value="ceiling">üè† Ceiling Work</option>
                                <option value="roofing">üèòÔ∏è Roofing</option>
                                <option value="wetwork">üíß Wet Work</option>
                            </optgroup>
                            <optgroup label="M&E Systems">
                                <option value="me-work">‚öôÔ∏è M&E Work</option>
                                <option value="exhaust">üå™Ô∏è Exhaust Systems</option>
                                <option value="lights-fan">üí° Lights & Fan</option>
                                <option value="ac">‚ùÑÔ∏è AC Systems</option>
                            </optgroup>
                            <optgroup label="Finishing">
                                <option value="paint">üé® Paint Works</option>
                                <option value="curtain">ü™ü Curtain & Blind</option>
                            </optgroup>
                            <optgroup label="Furniture">
                                <option value="builtin">üî® Built-in Furniture</option>
                                <option value="loose">ü™ë Loose Furniture</option>
                            </optgroup>
                            <optgroup label="Services">
                                <option value="sanitary">üöø Sanitary & Water Pump</option>
                                <option value="appliances">üì∫ Electrical Appliances</option>
                            </optgroup>
                            <optgroup label="Legacy Categories">
                                <option value="electrical">‚ö° Electrical</option>
                                <option value="plumbing">üîß Plumbing</option>
                                <option value="hvac">üå°Ô∏è HVAC</option>
                                <option value="cleaning">üßΩ Cleaning</option>
                                <option value="parts">üî© Parts & Materials</option>
                                <option value="labor">üë∑ Labor</option>
                                <option value="equipment">üõ†Ô∏è Equipment</option>
                                <option value="common">üè∑Ô∏è Common Items</option>
                            </optgroup>
                        </select>
                    </div>
                    
                    <div id="preset-items-list"></div>
                </div>

                <!-- Manual Add Section -->
                <div style="background: var(--bg-secondary); border-radius: 16px; padding: 24px; margin: 20px 0; border: 2px solid var(--accent-warm); box-shadow: 0 8px 32px var(--shadow-light);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <h4 style="font-size: 16px; font-weight: 700; color: var(--text-primary); display: flex; align-items: center; gap: 8px;">
                            ‚úèÔ∏è Manual Entry
                        </h4>
                    </div>
                    
                    <div style="display: grid; gap: 12px;">
                        <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 12px; align-items: end;">
                            <input type="text" style="padding: 14px 16px; border-radius: 12px; border: 2px solid var(--border-color); background: var(--bg-card); color: var(--text-primary); font-size: 14px; font-weight: 500; transition: all 0.2s ease;" placeholder="Item Description *" id="manual-description">
                            <input type="number" style="padding: 14px 16px; border-radius: 12px; border: 2px solid var(--border-color); background: var(--bg-card); color: var(--text-primary); font-size: 14px; font-weight: 500; transition: all 0.2s ease;" placeholder="Qty" id="manual-quantity" min="1" step="1" value="1">
                            <input type="number" style="padding: 14px 16px; border-radius: 12px; border: 2px solid var(--border-color); background: var(--bg-card); color: var(--text-primary); font-size: 14px; font-weight: 500; transition: all 0.2s ease;" placeholder="Price (RM)" id="manual-price" step="0.01">
                            <button type="button" style="padding: 14px 16px; border-radius: 12px; border: none; background: var(--accent-primary); color: white; font-weight: 600; cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; justify-content: center; gap: 6px; box-shadow: 0 2px 8px var(--shadow-light);" onclick="addManualItem()">
                                ‚ûï Add
                            </button>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                            <select style="padding: 14px 16px; border-radius: 12px; border: 2px solid var(--border-color); background: var(--bg-card); color: var(--text-primary); font-size: 14px; font-weight: 500; transition: all 0.2s ease;" id="manual-unit">
                                <option value="pcs">Pieces (pcs)</option>
                                <option value="hours">Hours</option>
                                <option value="sqft">Square Feet</option>
                                <option value="sqm">Square Meters</option>
                                <option value="meters">Meters</option>
                                <option value="kg">Kilograms</option>
                                <option value="liters">Liters</option>
                                <option value="set">Set</option>
                                <option value="lot">Lot</option>
                                <option value="service">Service</option>
                            </select>
                            
                            <select style="padding: 14px 16px; border-radius: 12px; border: 2px solid var(--border-color); background: var(--bg-card); color: var(--text-primary); font-size: 14px; font-weight: 500; transition: all 0.2s ease;" id="manual-category">
                                <optgroup label="Construction">
                                    <option value="preliminary">üèóÔ∏è Preliminary Work</option>
                                    <option value="wall">üß± Wall Work</option>
                                    <option value="floor">üè¢ Floor Work</option>
                                    <option value="ceiling">üè† Ceiling Work</option>
                                    <option value="roofing">üèòÔ∏è Roofing</option>
                                    <option value="wetwork">üíß Wet Work</option>
                                </optgroup>
                                <optgroup label="M&E Systems">
                                    <option value="me-work">‚öôÔ∏è M&E Work</option>
                                    <option value="exhaust">üå™Ô∏è Exhaust Systems</option>
                                    <option value="lights-fan">üí° Lights & Fan</option>
                                    <option value="ac">‚ùÑÔ∏è AC Systems</option>
                                </optgroup>
                                <optgroup label="Finishing">
                                    <option value="paint">üé® Paint Works</option>
                                    <option value="curtain">ü™ü Curtain & Blind</option>
                                </optgroup>
                                <optgroup label="Furniture">
                                    <option value="builtin">üî® Built-in Furniture</option>
                                    <option value="loose">ü™ë Loose Furniture</option>
                                </optgroup>
                                <optgroup label="Services">
                                    <option value="sanitary">üöø Sanitary & Water Pump</option>
                                    <option value="appliances">üì∫ Electrical Appliances</option>
                                </optgroup>
                                <optgroup label="Legacy">
                                    <option value="electrical">‚ö° Electrical</option>
                                    <option value="plumbing">üîß Plumbing</option>
                                    <option value="hvac">üå°Ô∏è HVAC</option>
                                    <option value="cleaning">üßΩ Cleaning</option>
                                    <option value="parts">üî© Parts & Materials</option>
                                    <option value="labor">üë∑ Labor</option>
                                    <option value="equipment">üõ†Ô∏è Equipment</option>
                                    <option value="common" selected>üè∑Ô∏è Common Items</option>
                                </optgroup>
                            </select>
                        </div>
                    </div>
                    
                    <div style="background: var(--bg-card); border-radius: 12px; padding: 16px; text-align: center; margin-top: 16px; border: 1px solid var(--border-color);">
                        <div style="font-size: 12px; font-weight: 600; color: var(--text-muted); margin-bottom: 4px;">Current Item Total</div>
                        <div style="font-size: 20px; font-weight: 700; color: var(--accent-primary);" id="manual-total">RM 0.00</div>
                    </div>
                </div>

                <!-- Quote Items List with Enhanced Categories -->
                <div id="quote-items-list"></div>

                <!-- Form Actions -->
                <div class="form-actions">
                    <button type="button" class="form-btn btn-primary" onclick="saveSimpleJob()">
                        ‚úÖ Save Job Quote
                    </button>
                    <button type="button" class="form-btn btn-secondary" onclick="closeSimpleJobForm()">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Preset Item Form Modal -->
    <div id="preset-item-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="preset-item-modal-title">‚ûï Add Preset Item</h3>
                <button class="close-btn" onclick="closePresetItemForm()">‚úï</button>
            </div>
            <div class="modal-body">
                <form id="preset-item-form">
                    <input type="text" class="form-input" placeholder="Item Name *" id="preset-item-name" required>
                    <textarea class="form-input" placeholder="Description" id="preset-item-description" rows="2" style="resize: none;"></textarea>
                    <input type="number" class="form-input" placeholder="Default Price (RM) *" id="preset-item-price" step="0.01" required>
                    <select class="form-input" id="preset-item-unit">
                        <option value="pcs">Pieces (pcs)</option>
                        <option value="hours">Hours</option>
                        <option value="sqft">Square Feet</option>
                        <option value="sqm">Square Meters</option>
                        <option value="meters">Meters</option>
                        <option value="kg">Kilograms</option>
                        <option value="liters">Liters</option>
                        <option value="set">Set</option>
                        <option value="lot">Lot</option>
                        <option value="service">Service</option>
                    </select>
                    <select class="form-input" id="preset-item-category">
                        <optgroup label="Construction">
                            <option value="preliminary">üèóÔ∏è Preliminary Work</option>
                            <option value="wall">üß± Wall Work</option>
                            <option value="floor">üè¢ Floor Work</option>
                            <option value="ceiling">üè† Ceiling Work</option>
                            <option value="roofing">üèòÔ∏è Roofing</option>
                            <option value="wetwork">üíß Wet Work</option>
                        </optgroup>
                        <optgroup label="M&E Systems">
                            <option value="me-work">‚öôÔ∏è M&E Work</option>
                            <option value="exhaust">üå™Ô∏è Exhaust Systems</option>
                            <option value="lights-fan">üí° Lights & Fan</option>
                            <option value="ac">‚ùÑÔ∏è AC Systems</option>
                        </optgroup>
                        <optgroup label="Finishing">
                            <option value="paint">üé® Paint Works</option>
                            <option value="curtain">ü™ü Curtain & Blind</option>
                        </optgroup>
                        <optgroup label="Furniture">
                            <option value="builtin">üî® Built-in Furniture</option>
                            <option value="loose">ü™ë Loose Furniture</option>
                        </optgroup>
                        <optgroup label="Services">
                            <option value="sanitary">üöø Sanitary & Water Pump</option>
                            <option value="appliances">üì∫ Electrical Appliances</option>
                        </optgroup>
                        <optgroup label="Legacy">
                            <option value="electrical">‚ö° Electrical</option>
                            <option value="plumbing">üîß Plumbing</option>
                            <option value="hvac">üå°Ô∏è HVAC</option>
                            <option value="cleaning">üßΩ Cleaning</option>
                            <option value="parts">üî© Parts & Materials</option>
                            <option value="labor">üë∑ Labor</option>
                            <option value="equipment">üõ†Ô∏è Equipment</option>
                            <option value="common" selected>üè∑Ô∏è Common Items</option>
                        </optgroup>
                    </select>
                    
                    <div class="form-actions">
                        <button type="submit" class="form-btn btn-primary">Save Preset</button>
                        <button type="button" class="form-btn btn-secondary" onclick="closePresetItemForm()">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Quote View Modal -->
    <div id="quote-view-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üí∞ Job Quote Details</h3>
                <button class="close-btn" onclick="closeQuoteView()">‚úï</button>
            </div>
            <div class="modal-body" id="quote-view-content">
                <!-- Content populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Success Message -->
    <div id="success-message" class="success-message">
        ‚úÖ Data saved successfully!
    </div>

    <script>
        // ========================================
        // REFIT MAINTENANCE SERVICES - PASTEL ORANGE THEME
        // Registration No: 201803348973 (002894203-V)
        // Enhanced with Pastel Orange Color Scheme
        // ========================================
        
        // App State Variables
        var currentView = 'dashboard';
        var jobQuotes = [];
        var presetWorkItems = [];
        var currentQuoteItems = [];
        var editingJob = null;
        var editingPreset = null;
        var selectedLogoIndex = 0;
        var currentTheme = 'light';
        var currentQuoteFilter = 'all';
        var currentPresetFilter = 'all';
        var customIcons = {};
        var userInfo = {};
        var customLogo = null;

        // Enhanced Category Configuration with Pastel Orange Variations
        var categories = {
            // New Construction Categories
            preliminary: {
                name: 'Preliminary Work',
                icon: 'üèóÔ∏è',
                color: 'var(--cat-preliminary)',
                description: 'Site preparation and preliminary construction work'
            },
            wall: {
                name: 'Wall Work',
                icon: 'üß±',
                color: 'var(--cat-wall)',
                description: 'Wall construction, renovation and finishing'
            },
            floor: {
                name: 'Floor Work',
                icon: 'üè¢',
                color: 'var(--cat-floor)',
                description: 'Flooring installation and finishing'
            },
            ceiling: {
                name: 'Ceiling Work',
                icon: 'üè†',
                color: 'var(--cat-ceiling)',
                description: 'Ceiling installation and finishing'
            },
            roofing: {
                name: 'Roofing',
                icon: 'üèòÔ∏è',
                color: 'var(--cat-roofing)',
                description: 'Roof installation and maintenance'
            },
            wetwork: {
                name: 'Wet Work',
                icon: 'üíß',
                color: 'var(--cat-wetwork)',
                description: 'Bathroom, kitchen and wet area work'
            },
            // New M&E Categories
            'me-work': {
                name: 'M&E Work',
                icon: '‚öôÔ∏è',
                color: 'var(--cat-me-work)',
                description: 'Mechanical and electrical systems'
            },
            exhaust: {
                name: 'Exhaust Systems',
                icon: 'üå™Ô∏è',
                color: 'var(--cat-exhaust)',
                description: 'Ventilation and exhaust systems'
            },
            'lights-fan': {
                name: 'Lights & Fan',
                icon: 'üí°',
                color: 'var(--cat-lights-fan)',
                description: 'Lighting and fan installations'
            },
            ac: {
                name: 'AC Systems',
                icon: '‚ùÑÔ∏è',
                color: 'var(--cat-ac)',
                description: 'Air conditioning systems'
            },
            // New Finishing Categories
            paint: {
                name: 'Paint Works',
                icon: 'üé®',
                color: 'var(--cat-paint)',
                description: 'Painting and finishing work'
            },
            curtain: {
                name: 'Curtain & Blind',
                icon: 'ü™ü',
                color: 'var(--cat-curtain)',
                description: 'Window treatments and coverings'
            },
            // New Furniture Categories
            builtin: {
                name: 'Built-in Furniture',
                icon: 'üî®',
                color: 'var(--cat-builtin)',
                description: 'Custom built-in furniture and storage'
            },
            loose: {
                name: 'Loose Furniture',
                icon: 'ü™ë',
                color: 'var(--cat-loose)',
                description: 'Movable furniture and furnishings'
            },
            // New Service Categories
            sanitary: {
                name: 'Sanitary & Water Pump',
                icon: 'üöø',
                color: 'var(--cat-sanitary)',
                description: 'Sanitary installations and water pump systems'
            },
            appliances: {
                name: 'Electrical Appliances',
                icon: 'üì∫',
                color: 'var(--cat-appliances)',
                description: 'Electrical appliances and equipment'
            },
            // Legacy Categories (keeping for backward compatibility)
            electrical: {
                name: 'Electrical',
                icon: '‚ö°',
                color: 'var(--cat-electrical)',
                description: 'Electrical systems, wiring, and components'
            },
            plumbing: {
                name: 'Plumbing',
                icon: 'üîß',
                color: 'var(--cat-plumbing)',
                description: 'Water systems, pipes, and fixtures'
            },
            hvac: {
                name: 'HVAC',
                icon: 'üå°Ô∏è',
                color: 'var(--cat-hvac)',
                description: 'Heating, ventilation, and air conditioning'
            },
            cleaning: {
                name: 'Cleaning',
                icon: 'üßΩ',
                color: 'var(--cat-cleaning)',
                description: 'Cleaning services and maintenance'
            },
            parts: {
                name: 'Parts & Materials',
                icon: 'üî©',
                color: 'var(--cat-parts)',
                description: 'Replacement parts and materials'
            },
            labor: {
                name: 'Labor',
                icon: 'üë∑',
                color: 'var(--cat-labor)',
                description: 'Labor charges and work hours'
            },
            equipment: {
                name: 'Equipment',
                icon: 'üõ†Ô∏è',
                color: 'var(--cat-equipment)',
                description: 'Tools and equipment'
            },
            common: {
                name: 'Common Items',
                icon: 'üè∑Ô∏è',
                color: 'var(--cat-common)',
                description: 'Frequently used items'
            }
        };

        // Company Settings
        var companySettings = {
            name: 'REFIT MAINTENANCE SERVICES',
            registration: '201803348973 (002894203-V)',
            tagline: 'Professional Maintenance Solutions',
            phone: '+60 3-7967 8888',
            email: 'info@refitmaintenance.my',
            website: 'www.refitmaintenance.my',
            address: 'No. 15, Jalan Teknologi 3/6, Kota Damansara, 47810 Petaling Jaya, Selangor, Malaysia'
        };

        // Storage Keys
        var STORAGE_KEYS = {
            JOB_QUOTES: 'refit_enhanced_job_quotes',
            PRESET_WORK_ITEMS: 'refit_enhanced_preset_items',
            SELECTED_LOGO: 'refit_selected_logo',
            THEME_PREFERENCE: 'refit_theme_preference',
            CUSTOM_ICONS: 'refit_custom_icons',
            USER_INFO: 'refit_user_info',
            CUSTOM_LOGO: 'refit_custom_logo'
        };

        // Enhanced Default Preset Work Items with New Categories
        var defaultPresetWorkItems = [
            // Preliminary Work
            { id: 'preliminary-survey', name: 'Site Survey & Assessment', description: 'Initial site evaluation and condition assessment', price: 250.00, unit: 'service', category: 'preliminary' },
            { id: 'preliminary-protection', name: 'Protective Covering', description: 'Floor and furniture protection during work', price: 120.00, unit: 'service', category: 'preliminary' },
            { id: 'preliminary-demolition', name: 'Selective Demolition', description: 'Careful removal of existing structures', price: 85.00, unit: 'sqm', category: 'preliminary' },
            { id: 'preliminary-cleanup', name: 'Site Cleanup', description: 'Construction debris removal and cleaning', price: 45.00, unit: 'hours', category: 'preliminary' },
            
            // Wall Work
            { id: 'wall-drywall-install', name: 'Drywall Installation', description: 'Standard drywall installation with finishing', price: 35.00, unit: 'sqm', category: 'wall' },
            { id: 'wall-partition', name: 'Partition Wall Construction', description: 'Metal stud partition wall with drywall', price: 65.00, unit: 'sqm', category: 'wall' },
            { id: 'wall-repair-patch', name: 'Wall Patching & Repair', description: 'Minor wall damage repair and patching', price: 25.00, unit: 'sqm', category: 'wall' },
            { id: 'wall-texture-finish', name: 'Wall Texture Finishing', description: 'Decorative wall texture application', price: 18.00, unit: 'sqm', category: 'wall' },
            
            // Floor Work
            { id: 'floor-vinyl-install', name: 'Vinyl Flooring Installation', description: 'Commercial grade vinyl flooring', price: 45.00, unit: 'sqm', category: 'floor' },
            { id: 'floor-carpet-install', name: 'Carpet Installation', description: 'Commercial carpet with padding', price: 55.00, unit: 'sqm', category: 'floor' },
            { id: 'floor-tile-install', name: 'Ceramic Tile Installation', description: 'Floor tile installation with grouting', price: 68.00, unit: 'sqm', category: 'floor' },
            { id: 'floor-hardwood-install', name: 'Hardwood Flooring', description: 'Engineered hardwood flooring installation', price: 95.00, unit: 'sqm', category: 'floor' },
            { id: 'floor-leveling', name: 'Floor Leveling', description: 'Floor surface preparation and leveling', price: 28.00, unit: 'sqm', category: 'floor' },
            
            // Ceiling Work
            { id: 'ceiling-suspended', name: 'Suspended Ceiling Installation', description: 'Mineral fiber suspended ceiling system', price: 42.00, unit: 'sqm', category: 'ceiling' },
            { id: 'ceiling-drywall', name: 'Drywall Ceiling', description: 'Drywall ceiling installation and finishing', price: 38.00, unit: 'sqm', category: 'ceiling' },
            { id: 'ceiling-repair', name: 'Ceiling Repair', description: 'Water damage and crack repair', price: 35.00, unit: 'sqm', category: 'ceiling' },
            { id: 'ceiling-insulation', name: 'Ceiling Insulation', description: 'Thermal insulation installation', price: 22.00, unit: 'sqm', category: 'ceiling' },
            
            // Paint Works
            { id: 'paint-interior-wall', name: 'Interior Wall Painting', description: 'Two coats premium interior paint', price: 12.00, unit: 'sqm', category: 'paint' },
            { id: 'paint-exterior-wall', name: 'Exterior Wall Painting', description: 'Weather-resistant exterior paint', price: 18.00, unit: 'sqm', category: 'paint' },
            { id: 'paint-ceiling', name: 'Ceiling Painting', description: 'Ceiling paint with primer', price: 15.00, unit: 'sqm', category: 'paint' },
            { id: 'paint-texture', name: 'Texture Paint Application', description: 'Decorative texture paint finish', price: 25.00, unit: 'sqm', category: 'paint' },
            { id: 'paint-primer', name: 'Surface Primer Application', description: 'Primer coat for new surfaces', price: 8.00, unit: 'sqm', category: 'paint' },
            
            // Electrical (Legacy)
            { id: 'electrical-inspection', name: 'Electrical Safety Inspection', description: 'Complete electrical system safety check', price: 150.00, unit: 'service', category: 'electrical' },
            { id: 'electrical-outlet', name: 'Power Outlet Installation', description: 'Standard 13A power outlet', price: 45.00, unit: 'pcs', category: 'electrical' },
            { id: 'plumbing-pipe-repair', name: 'Pipe Repair Service', description: 'Water pipe leak repair', price: 65.00, unit: 'service', category: 'plumbing' },
            { id: 'hvac-filter-change', name: 'HVAC Filter Replacement', description: 'Air filter replacement service', price: 35.00, unit: 'pcs', category: 'hvac' },
            { id: 'cleaning-office', name: 'Office Cleaning Service', description: 'Standard office cleaning', price: 25.00, unit: 'sqm', category: 'cleaning' },
            { id: 'parts-electrical-wire', name: 'Electrical Wire', description: 'Standard electrical wiring cable', price: 8.50, unit: 'meters', category: 'parts' },
            { id: 'labor-technician', name: 'Technician Labor', description: 'Skilled technician work hour', price: 45.00, unit: 'hours', category: 'labor' },
            { id: 'equipment-drill-rental', name: 'Power Drill Rental', description: 'Professional power drill rental', price: 35.00, unit: 'hours', category: 'equipment' },
            { id: 'common-service-call', name: 'Service Call Fee', description: 'Basic service call charge', price: 75.00, unit: 'service', category: 'common' }
        ];

        // Theme Management Functions
        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.body.setAttribute('data-theme', currentTheme);
            
            var toggleBtn = document.getElementById('theme-toggle');
            if (toggleBtn) {
                toggleBtn.textContent = currentTheme === 'light' ? 'üåô Dark' : '‚òÄÔ∏è Light';
            }
            
            var metaTheme = document.querySelector('meta[name="theme-color"]');
            if (metaTheme) {
                metaTheme.content = currentTheme === 'light' ? '#FFB07A' : '#1a1411';
            }
            
            saveDataToStorage();
            showSuccessMessage(currentTheme === 'light' ? '‚òÄÔ∏è Light mode activated' : 'üåô Dark mode activated - Easy on the eyes!');
        }

        function loadThemePreference() {
            var savedTheme = JSON.parse(localStorage.getItem(STORAGE_KEYS.THEME_PREFERENCE)) || 'light';
            
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches && !localStorage.getItem(STORAGE_KEYS.THEME_PREFERENCE)) {
                savedTheme = 'dark';
            }
            
            currentTheme = savedTheme;
            document.body.setAttribute('data-theme', currentTheme);
            
            var toggleBtn = document.getElementById('theme-toggle');
            if (toggleBtn) {
                toggleBtn.textContent = currentTheme === 'light' ? 'üåô Dark' : '‚òÄÔ∏è Light';
            }
            
            var metaTheme = document.querySelector('meta[name="theme-color"]');
            if (metaTheme) {
                metaTheme.content = currentTheme === 'light' ? '#FFB07A' : '#1a1411';
            }
        }

        // User Info Management Functions
        function openUserInfo() {
            loadUserInfo();
            document.getElementById('user-info-modal').classList.add('show');
            showSuccessMessage('üë§ User info panel opened');
        }

        function closeUserInfo() {
            document.getElementById('user-info-modal').classList.remove('show');
        }

        function loadUserInfo() {
            var savedUserInfo = localStorage.getItem(STORAGE_KEYS.USER_INFO);
            if (savedUserInfo) {
                userInfo = JSON.parse(savedUserInfo);
            }
            
            document.getElementById('user-company-name').value = userInfo.companyName || companySettings.name;
            document.getElementById('user-registration').value = userInfo.registration || companySettings.registration;
            document.getElementById('user-phone').value = userInfo.phone || companySettings.phone;
            document.getElementById('user-email').value = userInfo.email || companySettings.email;
            document.getElementById('user-address').value = userInfo.address || companySettings.address;
            document.getElementById('user-website').value = userInfo.website || companySettings.website;
            
            // Load custom logo preview
            var savedLogo = localStorage.getItem(STORAGE_KEYS.CUSTOM_LOGO);
            if (savedLogo) {
                customLogo = savedLogo;
                showLogoPreview(savedLogo);
            }
        }

        function saveUserInfo() {
            userInfo = {
                companyName: document.getElementById('user-company-name').value.trim(),
                registration: document.getElementById('user-registration').value.trim(),
                phone: document.getElementById('user-phone').value.trim(),
                email: document.getElementById('user-email').value.trim(),
                address: document.getElementById('user-address').value.trim(),
                website: document.getElementById('user-website').value.trim()
            };
            
            // Update company settings
            companySettings.name = userInfo.companyName || companySettings.name;
            companySettings.registration = userInfo.registration || companySettings.registration;
            companySettings.phone = userInfo.phone || companySettings.phone;
            companySettings.email = userInfo.email || companySettings.email;
            companySettings.address = userInfo.address || companySettings.address;
            companySettings.website = userInfo.website || companySettings.website;
            
            // Update header display
            document.getElementById('company-name').textContent = companySettings.name;
            document.getElementById('company-registration').innerHTML = 'Registration No: ' + companySettings.registration.split('(')[0] + '<br>(' + companySettings.registration.split('(')[1];
            
            localStorage.setItem(STORAGE_KEYS.USER_INFO, JSON.stringify(userInfo));
            saveDataToStorage();
            closeUserInfo();
            showSuccessMessage('‚úÖ User information saved successfully!');
        }

        function handleLogoUpload(event) {
            var file = event.target.files[0];
            if (!file) return;
            
            if (file.size > 2 * 1024 * 1024) {
                showSuccessMessage('‚ö†Ô∏è File too large! Please choose an image under 2MB');
                return;
            }
            
            if (!file.type.startsWith('image/')) {
                showSuccessMessage('‚ö†Ô∏è Please select a valid image file');
                return;
            }
            
            var reader = new FileReader();
            reader.onload = function(e) {
                customLogo = e.target.result;
                localStorage.setItem(STORAGE_KEYS.CUSTOM_LOGO, customLogo);
                showLogoPreview(customLogo);
                applyCustomLogo();
                showSuccessMessage('‚úÖ Custom logo uploaded successfully!');
            };
            reader.readAsDataURL(file);
        }

        function showLogoPreview(logoData) {
            var previewContainer = document.getElementById('logo-preview');
            if (previewContainer) {
                previewContainer.innerHTML = '<img src="' + logoData + '" class="upload-preview" alt="Logo Preview">';
            }
        }

        function removeCustomLogo() {
            if (confirm('Remove custom logo and revert to default?')) {
                customLogo = null;
                localStorage.removeItem(STORAGE_KEYS.CUSTOM_LOGO);
                document.getElementById('logo-preview').innerHTML = '';
                document.getElementById('logo-upload').value = '';
                
                // Revert to default logo
                var logoContainer = document.getElementById('main-logo');
                if (logoContainer) {
                    logoContainer.innerHTML = logoTemplates[selectedLogoIndex];
                }
                showSuccessMessage('üóëÔ∏è Custom logo removed - reverted to default');
            }
        }

        function applyCustomLogo() {
            if (customLogo) {
                var logoContainer = document.getElementById('main-logo');
                if (logoContainer) {
                    logoContainer.innerHTML = '<img src="' + customLogo + '" class="user-logo" alt="Custom Logo">';
                }
            }
        }

        // Icon Upload Management Functions
        function openIconUpload() {
            renderCategoryIconList();
            document.getElementById('icon-upload-modal').classList.add('show');
            showSuccessMessage('üé® Category icon upload panel opened');
        }

        function closeIconUpload() {
            document.getElementById('icon-upload-modal').classList.remove('show');
        }

        function renderCategoryIconList() {
            var container = document.getElementById('category-icon-list');
            if (!container) return;
            
            var html = '';
            
            for (var categoryKey in categories) {
                var category = categories[categoryKey];
                var customIcon = customIcons[categoryKey];
                
                html += '<div style="background: var(--bg-secondary); border-radius: 12px; padding: 16px; margin-bottom: 12px; border: 1px solid var(--border-color);">' +
                    '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">' +
                    '<div style="display: flex; align-items: center; gap: 12px;">' +
                    '<div class="category-icon ' + categoryKey + '" style="width: 32px; height: 32px;">' +
                    (customIcon ? '<img src="' + customIcon + '" class="custom-icon" alt="' + category.name + '">' : category.icon) +
                    '</div>' +
                    '<div>' +
                    '<div style="font-weight: 700; color: var(--text-primary); font-size: 14px;">' + category.name + '</div>' +
                    '<div style="font-size: 12px; color: var(--text-muted);">' + category.description + '</div>' +
                    '</div>' +
                    '</div>' +
                    '<div style="display: flex; gap: 8px;">' +
                    '<div class="file-upload" style="margin: 0;">' +
                    '<input type="file" id="icon-' + categoryKey + '" accept="image/*" onchange="handleCategoryIconUpload(event, \'' + categoryKey + '\')" style="position: absolute; left: -9999px;">' +
                    '<label for="icon-' + categoryKey + '" style="display: flex; align-items: center; gap: 6px; padding: 8px 12px; color: white; font-weight: 600; font-size: 12px; cursor: pointer; border-radius: 8px; background: var(--accent-primary);">' +
                    '<span>üìÅ</span><span>Upload</span>' +
                    '</label>' +
                    '</div>' +
                    (customIcon ? '<button onclick="removeCategoryIcon(\'' + categoryKey + '\')" style="padding: 8px 12px; border-radius: 8px; border: none; background: var(--accent-warm); color: white; font-size: 12px; cursor: pointer;">üóëÔ∏è</button>' : '') +
                    '</div>' +
                    '</div>' +
                    '</div>';
            }
            
            container.innerHTML = html;
        }

        function handleCategoryIconUpload(event, categoryKey) {
            var file = event.target.files[0];
            if (!file) return;
            
            if (file.size > 1024 * 1024) {
                showSuccessMessage('‚ö†Ô∏è File too large! Please choose an image under 1MB');
                return;
            }
            
            if (!file.type.startsWith('image/')) {
                showSuccessMessage('‚ö†Ô∏è Please select a valid image file');
                return;
            }
            
            var reader = new FileReader();
            reader.onload = function(e) {
                customIcons[categoryKey] = e.target.result;
                localStorage.setItem(STORAGE_KEYS.CUSTOM_ICONS, JSON.stringify(customIcons));
                updateCategoryIconsDisplay();
                renderCategoryIconList();
                showSuccessMessage('‚úÖ ' + categories[categoryKey].name + ' icon uploaded!');
            };
            reader.readAsDataURL(file);
        }

        function removeCategoryIcon(categoryKey) {
            if (confirm('Remove custom icon for ' + categories[categoryKey].name + '?')) {
                delete customIcons[categoryKey];
                localStorage.setItem(STORAGE_KEYS.CUSTOM_ICONS, JSON.stringify(customIcons));
                updateCategoryIconsDisplay();
                renderCategoryIconList();
                showSuccessMessage('üóëÔ∏è ' + categories[categoryKey].name + ' icon removed');
            }
        }

        function resetAllIcons() {
            if (confirm('Reset all category icons to default?\nThis will remove all custom uploaded icons.')) {
                customIcons = {};
                localStorage.removeItem(STORAGE_KEYS.CUSTOM_ICONS);
                updateCategoryIconsDisplay();
                renderCategoryIconList();
                showSuccessMessage('üîÑ All category icons reset to default');
            }
        }

        function updateCategoryIconsDisplay() {
            // Update all category icon displays throughout the app
            for (var categoryKey in categories) {
                var category = categories[categoryKey];
                var customIcon = customIcons[categoryKey];
                var iconContent = customIcon ? '<img src="' + customIcon + '" class="custom-icon" alt="' + category.name + '">' : category.icon;
                
                // Update in filters
                var filterIcon = document.getElementById('icon-' + categoryKey);
                if (filterIcon) {
                    filterIcon.innerHTML = iconContent;
                }
                
                var presetFilterIcon = document.getElementById('preset-icon-' + categoryKey);
                if (presetFilterIcon) {
                    presetFilterIcon.innerHTML = iconContent;
                }
            }
        }

        function loadCustomIcons() {
            var savedIcons = localStorage.getItem(STORAGE_KEYS.CUSTOM_ICONS);
            if (savedIcons) {
                customIcons = JSON.parse(savedIcons);
                updateCategoryIconsDisplay();
            }
        }

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            loadThemePreference();
            loadDataFromStorage();
            loadCustomIcons();
            loadUserInfo();
            setupEventListeners();
            setupMobileOptimizations();
            updateStatusBar();
            updateCurrentDate();
            updateStats();
            renderViews();
            loadSelectedLogo();
            updateCategoryFilters();
            
            // Apply custom logo if exists
            if (customLogo) {
                applyCustomLogo();
            }
            
            showSuccessMessage('üçë REFIT ENHANCED - Beautiful Pastel Orange Theme Ready!');
            console.log('üîß REFIT MAINTENANCE SERVICES - Pastel Orange Theme');
            console.log('üçë Beautiful Pastel Orange Color Scheme');
            console.log('üé® Custom Icon Upload & User Info Management');
            console.log('üìä Expanded Category System with 24 Categories');
            console.log('üëÅÔ∏è Eye-Friendly Design for Extended Use');
        }

        // Category Management Functions
        function getCategoryIcon(category) {
            var customIcon = customIcons[category];
            if (customIcon) {
                return '<img src="' + customIcon + '" class="custom-icon" alt="' + categories[category].name + '">';
            }
            return categories[category] ? categories[category].icon : 'üè∑Ô∏è';
        }

        function getCategoryName(category) {
            return categories[category] ? categories[category].name : 'Unknown';
        }

        function getCategoryColor(category) {
            return categories[category] ? categories[category].color : 'var(--cat-common)';
        }

        function filterQuotesByCategory(category) {
            currentQuoteFilter = category;
            
            // Update filter buttons
            var filters = document.querySelectorAll('#quotes-view .category-filter[data-category]');
            for (var i = 0; i < filters.length; i++) {
                filters[i].classList.remove('active');
            }
            
            var activeFilter = document.querySelector('#quotes-view .category-filter[data-category="' + category + '"]');
            if (activeFilter) {
                activeFilter.classList.add('active');
            }
            
            renderQuotes();
            showSuccessMessage('üìã Filtered by ' + (category === 'all' ? 'All Categories' : getCategoryName(category)));
        }

        function filterPresetsByCategory(category) {
            currentPresetFilter = category;
            
            // Update filter buttons
            var filters = document.querySelectorAll('#presets-view .category-filter[data-category]');
            for (var i = 0; i < filters.length; i++) {
                filters[i].classList.remove('active');
            }
            
            var activeFilter = document.querySelector('#presets-view .category-filter[data-category="' + category + '"]');
            if (activeFilter) {
                activeFilter.classList.add('active');
            }
            
            renderPresets();
            showSuccessMessage('üìã Filtered by ' + (category === 'all' ? 'All Categories' : getCategoryName(category)));
        }

        function filterPresetItemsInModal() {
            var selectedCategory = document.getElementById('preset-category-selector').value;
            renderPresetItems(selectedCategory);
        }

        function updateCategoryFilters() {
            updateQuoteCategoryFilters();
            updatePresetCategoryFilters();
        }

        function updateQuoteCategoryFilters() {
            var categoryCounts = { all: jobQuotes.length };
            
            // Initialize category counts
            for (var catKey in categories) {
                categoryCounts[catKey] = 0;
            }
            
            // Count quotes by category
            for (var i = 0; i < jobQuotes.length; i++) {
                var quote = jobQuotes[i];
                var quoteCategories = {};
                
                for (var j = 0; j < quote.items.length; j++) {
                    var item = quote.items[j];
                    var itemCategory = item.category || 'common';
                    quoteCategories[itemCategory] = true;
                }
                
                for (var cat in quoteCategories) {
                    if (categoryCounts[cat] !== undefined) {
                        categoryCounts[cat]++;
                    }
                }
            }
            
            // Update filter counts
            for (var catKey in categoryCounts) {
                var countElement = document.getElementById('filter-count-' + catKey);
                if (countElement) {
                    countElement.textContent = categoryCounts[catKey];
                }
            }
        }

        function updatePresetCategoryFilters() {
            var categoryCounts = { all: presetWorkItems.length };
            
            // Initialize category counts
            for (var catKey in categories) {
                categoryCounts[catKey] = 0;
            }
            
            // Count presets by category
            for (var i = 0; i < presetWorkItems.length; i++) {
                var preset = presetWorkItems[i];
                var category = preset.category || 'common';
                if (categoryCounts[category] !== undefined) {
                    categoryCounts[category]++;
                }
            }
            
            // Update filter counts
            for (var catKey in categoryCounts) {
                var countElement = document.getElementById('preset-filter-count-' + catKey);
                if (countElement) {
                    countElement.textContent = categoryCounts[catKey];
                }
            }
        }

        // Data Management Functions
        function saveDataToStorage() {
            try {
                localStorage.setItem(STORAGE_KEYS.JOB_QUOTES, JSON.stringify(jobQuotes));
                localStorage.setItem(STORAGE_KEYS.PRESET_WORK_ITEMS, JSON.stringify(presetWorkItems));
                localStorage.setItem(STORAGE_KEYS.SELECTED_LOGO, selectedLogoIndex.toString());
                localStorage.setItem(STORAGE_KEYS.THEME_PREFERENCE, JSON.stringify(currentTheme));
                localStorage.setItem(STORAGE_KEYS.CUSTOM_ICONS, JSON.stringify(customIcons));
                localStorage.setItem(STORAGE_KEYS.USER_INFO, JSON.stringify(userInfo));
                if (customLogo) {
                    localStorage.setItem(STORAGE_KEYS.CUSTOM_LOGO, customLogo);
                }
            } catch (e) {
                console.warn('Storage error:', e);
                showSuccessMessage('‚ö†Ô∏è Storage full! Please export data.');
            }
        }

        function loadDataFromStorage() {
            try {
                var savedQuotes = localStorage.getItem(STORAGE_KEYS.JOB_QUOTES);
                if (savedQuotes) {
                    jobQuotes = JSON.parse(savedQuotes);
                }

                var savedPresets = localStorage.getItem(STORAGE_KEYS.PRESET_WORK_ITEMS);
                if (savedPresets) {
                    presetWorkItems = JSON.parse(savedPresets);
                } else {
                    presetWorkItems = [...defaultPresetWorkItems];
                    saveDataToStorage();
                }

                var savedLogo = localStorage.getItem(STORAGE_KEYS.SELECTED_LOGO);
                if (savedLogo !== null) {
                    selectedLogoIndex = parseInt(savedLogo);
                }

                var savedCustomLogo = localStorage.getItem(STORAGE_KEYS.CUSTOM_LOGO);
                if (savedCustomLogo) {
                    customLogo = savedCustomLogo;
                }

                var savedUserInfo = localStorage.getItem(STORAGE_KEYS.USER_INFO);
                if (savedUserInfo) {
                    userInfo = JSON.parse(savedUserInfo);
                    // Update company settings from user info
                    if (userInfo.companyName) companySettings.name = userInfo.companyName;
                    if (userInfo.registration) companySettings.registration = userInfo.registration;
                    if (userInfo.phone) companySettings.phone = userInfo.phone;
                    if (userInfo.email) companySettings.email = userInfo.email;
                    if (userInfo.address) companySettings.address = userInfo.address;
                    if (userInfo.website) companySettings.website = userInfo.website;
                }

            } catch (e) {
                console.warn('Load error:', e);
                presetWorkItems = [...defaultPresetWorkItems];
                selectedLogoIndex = 0;
            }
        }

        // Simple Job Form Functions
        function openSimpleJobForm() {
            currentQuoteItems = [];
            editingJob = null;
            document.getElementById('simple-job-modal-title').textContent = 'üí∞ Create Job Quote';
            document.getElementById('simple-job-title').value = '';
            document.getElementById('preset-category-selector').value = 'all';
            renderPresetItems('all');
            updateQuoteItemsDisplay();
            document.getElementById('simple-job-modal').classList.add('show');
            showSuccessMessage('üí∞ Enhanced Job Quote form opened!');
        }

        function closeSimpleJobForm() {
            document.getElementById('simple-job-modal').classList.remove('show');
            currentQuoteItems = [];
            updateQuoteItemsDisplay();
        }

        function renderPresetItems(filterCategory) {
            filterCategory = filterCategory || 'all';
            var container = document.getElementById('preset-items-list');
            if (!container) return;
            
            var filteredItems = presetWorkItems.filter(function(item) {
                return filterCategory === 'all' || item.category === filterCategory;
            });
            
            if (filteredItems.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-muted);">' +
                    '<div style="font-size: 32px; margin-bottom: 8px;">üìã</div>' +
                    '<p>No preset items in this category</p>' +
                    '<p style="font-size: 12px; margin-top: 4px;">Try selecting a different category</p>' +
                    '</div>';
                return;
            }
            
            // Group items by category for better organization
            var groupedItems = {};
            for (var i = 0; i < filteredItems.length; i++) {
                var item = filteredItems[i];
                var category = item.category || 'common';
                if (!groupedItems[category]) {
                    groupedItems[category] = [];
                }
                groupedItems[category].push(item);
            }
            
            var html = '';
            
            if (filterCategory === 'all') {
                // Show all categories grouped
                for (var category in groupedItems) {
                    var categoryItems = groupedItems[category];
                    if (categoryItems.length === 0) continue;
                    
                    html += '<div style="margin-bottom: 20px;">' +
                        '<div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px; padding: 8px 12px; background: var(--bg-secondary); border-radius: 8px;">' +
                        '<span style="font-size: 18px;">' + getCategoryIcon(category) + '</span>' +
                        '<span style="font-weight: 700; color: var(--text-primary);">' + getCategoryName(category) + '</span>' +
                        '<span class="category-badge category-' + category + '">' + categoryItems.length + '</span>' +
                        '</div>';
                    
                    for (var j = 0; j < categoryItems.length; j++) {
                        var item = categoryItems[j];
                        html += renderPresetItemCard(item);
                    }
                    
                    html += '</div>';
                }
            } else {
                // Show items in selected category only
                for (var i = 0; i < filteredItems.length; i++) {
                    var item = filteredItems[i];
                    html += renderPresetItemCard(item);
                }
            }
            
            container.innerHTML = html;
        }

        function renderPresetItemCard(item) {
            return '<div style="background: var(--bg-secondary); border-radius: 12px; padding: 16px; margin-bottom: 12px; border: 1px solid var(--border-color); cursor: pointer; transition: all 0.2s ease;" onclick="selectPresetItem(\'' + item.id + '\')" onmouseover="this.style.transform=\'scale(1.02)\'" onmouseout="this.style.transform=\'scale(1)\'">' +
                '<div style="display: flex; justify-content: space-between; align-items: center;">' +
                '<div style="flex: 1;">' +
                '<div style="font-weight: 700; margin-bottom: 4px; color: var(--text-primary); font-size: 15px;">' +
                '<span style="margin-right: 8px;">' + getCategoryIcon(item.category) + '</span>' +
                item.name + '</div>' +
                '<div style="font-size: 13px; color: var(--text-muted); margin-bottom: 4px;">' + item.description + ' ‚Ä¢ ' + item.unit + '</div>' +
                '<div style="font-size: 12px; color: var(--text-muted);">Category: ' + getCategoryName(item.category) + '</div>' +
                '</div>' +
                '<div style="display: flex; align-items: center; gap: 12px;">' +
                '<div style="font-weight: 700; color: var(--accent-primary); font-size: 15px;">RM ' + parseFloat(item.price).toFixed(2) + '</div>' +
                '<button style="background: var(--accent-primary); color: white; border: none; border-radius: 8px; padding: 8px 16px; font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.2s ease; box-shadow: 0 2px 6px var(--shadow-light);" onclick="event.stopPropagation(); addPresetToQuote(\'' + item.id + '\')" onmouseover="this.style.transform=\'translateY(-1px)\'; this.style.background=\'var(--accent-secondary)\'" onmouseout="this.style.transform=\'translateY(0)\'; this.style.background=\'var(--accent-primary)\'">' +
                '‚ûï Add' +
                '</button>' +
                '</div>' +
                '</div>' +
                '</div>';
        }

        function selectPresetItem(itemId) {
            var item = presetWorkItems.find(function(item) { return item.id === itemId; });
            if (!item) return;
            
            document.getElementById('manual-description').value = item.name;
            document.getElementById('manual-quantity').value = '1';
            document.getElementById('manual-price').value = item.price;
            document.getElementById('manual-unit').value = item.unit;
            document.getElementById('manual-category').value = item.category;
            
            updateManualTotal();
            showSuccessMessage('‚úÖ "' + item.name + '" selected for manual entry');
        }

        function addPresetToQuote(itemId) {
            var item = presetWorkItems.find(function(item) { return item.id === itemId; });
            if (!item) return;
            
            var quoteItem = {
                id: Date.now(),
                description: item.name,
                quantity: 1,
                price: item.price,
                unit: item.unit,
                category: item.category,
                total: item.price,
                isPreset: true,
                presetId: item.id
            };
            
            currentQuoteItems.push(quoteItem);
            updateQuoteItemsDisplay();
            showSuccessMessage('‚úÖ "' + item.name + '" added to quote!');
        }

        function updateManualTotal() {
            var quantity = parseFloat(document.getElementById('manual-quantity').value) || 0;
            var price = parseFloat(document.getElementById('manual-price').value) || 0;
            var total = quantity * price;
            
            var totalElement = document.getElementById('manual-total');
            if (totalElement) {
                totalElement.textContent = 'RM ' + total.toFixed(2);
            }
        }

        function addManualItem() {
            var description = document.getElementById('manual-description').value.trim();
            var quantity = parseFloat(document.getElementById('manual-quantity').value);
            var price = parseFloat(document.getElementById('manual-price').value);
            var unit = document.getElementById('manual-unit').value;
            var category = document.getElementById('manual-category').value;
            
            if (!description || !quantity || !price) {
                showSuccessMessage('‚ö†Ô∏è Please fill in all required fields!');
                return;
            }
            
            var quoteItem = {
                id: Date.now(),
                description: description,
                quantity: quantity,
                price: price,
                unit: unit,
                category: category,
                total: quantity * price,
                isPreset: false
            };
            
            currentQuoteItems.push(quoteItem);
            
            // Clear form
            document.getElementById('manual-description').value = '';
            document.getElementById('manual-quantity').value = '1';
            document.getElementById('manual-price').value = '';
            document.getElementById('manual-unit').value = 'pcs';
            document.getElementById('manual-category').value = 'common';
            
            updateManualTotal();
            updateQuoteItemsDisplay();
            showSuccessMessage('‚úÖ Quote item added manually!');
        }

        function updateQuoteItemsDisplay() {
            var container = document.getElementById('quote-items-list');
            if (!container) return;
            
            if (currentQuoteItems.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            // Group items by category
            var groupedItems = {};
            var total = 0;
            
            for (var i = 0; i < currentQuoteItems.length; i++) {
                var item = currentQuoteItems[i];
                var category = item.category || 'common';
                total += item.total;
                
                if (!groupedItems[category]) {
                    groupedItems[category] = [];
                }
                groupedItems[category].push({ item: item, index: i });
            }
            
            var html = '<div style="background: var(--bg-secondary); border-radius: 16px; padding: 24px; margin: 20px 0; border: 2px solid var(--accent-primary); box-shadow: 0 8px 32px var(--shadow-light);">' +
                '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">' +
                '<div style="font-size: 18px; font-weight: 700; color: var(--text-primary); display: flex; align-items: center; gap: 8px;">üí∞ Quote Items (' + currentQuoteItems.length + ')</div>' +
                '<button type="button" onclick="clearAllQuoteItems()" style="background: var(--accent-warm); color: white; border: none; border-radius: 8px; padding: 4px 8px; font-size: 12px; cursor: pointer;">Clear All</button>' +
                '</div>';
            
            // Render items grouped by category
            for (var category in groupedItems) {
                var categoryItems = groupedItems[category];
                var categoryTotal = 0;
                
                for (var j = 0; j < categoryItems.length; j++) {
                    categoryTotal += categoryItems[j].item.total;
                }
                
                html += '<div style="margin-bottom: 16px; border-radius: 12px; overflow: hidden; border: 2px solid ' + getCategoryColor(category) + '; box-shadow: 0 4px 12px var(--shadow-light);">' +
                    '<div style="padding: 16px 20px; background: var(--bg-card); display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color);">' +
                    '<div style="display: flex; align-items: center; gap: 12px; font-weight: 700; font-size: 16px; color: var(--text-primary);">' +
                    '<div style="width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-size: 16px; background: ' + getCategoryColor(category) + ';">' + getCategoryIcon(category) + '</div>' +
                    '<span>' + getCategoryName(category) + '</span>' +
                    '</div>' +
                    '<div style="display: flex; align-items: center; gap: 12px; font-size: 12px; color: var(--text-muted);">' +
                    '<span>' + categoryItems.length + ' items</span>' +
                    '<span style="font-weight: 700; color: var(--accent-primary);">RM ' + categoryTotal.toFixed(2) + '</span>' +
                    '</div>' +
                    '</div>' +
                    '<div style="background: var(--bg-card);">';
                
                for (var j = 0; j < categoryItems.length; j++) {
                    var itemData = categoryItems[j];
                    var item = itemData.item;
                    var index = itemData.index;
                    
                    html += '<div style="background: var(--bg-card); border-radius: 12px; padding: 20px; margin: 16px; border: 1px solid var(--border-color); box-shadow: 0 4px 12px var(--shadow-light); position: relative;">' +
                        '<div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px;">' +
                        '<div style="font-weight: 700; color: var(--text-primary); font-size: 16px;">' +
                        '<span style="margin-right: 8px;">' + getCategoryIcon(category) + '</span>' +
                        item.description + (item.isPreset ? ' üè∑Ô∏è' : '') + '</div>' +
                        '<div style="display: flex; gap: 8px;">' +
                        '<button style="width: 36px; height: 36px; border-radius: 8px; border: none; background: var(--accent-primary); color: white; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s ease; font-size: 14px;" onclick="editQuoteItem(' + index + ')" title="Edit">‚úèÔ∏è</button>' +
                        '<button style="width: 36px; height: 36px; border-radius: 8px; border: none; background: var(--accent-warm); color: white; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s ease; font-size: 14px;" onclick="deleteQuoteItem(' + index + ')" title="Delete">üóëÔ∏è</button>' +
                        '</div>' +
                        '</div>' +
                        '<div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; font-size: 14px; color: var(--text-secondary);">' +
                        '<div style="text-align: center;">' +
                        '<div style="font-size: 12px; font-weight: 600; color: var(--text-muted); margin-bottom: 4px;">Quantity</div>' +
                        '<div style="font-weight: 700; color: var(--text-primary);">' + item.quantity + ' ' + item.unit + '</div>' +
                        '</div>' +
                        '<div style="text-align: center;">' +
                        '<div style="font-size: 12px; font-weight: 600; color: var(--text-muted); margin-bottom: 4px;">Unit Price</div>' +
                        '<div style="font-weight: 700; color: var(--text-primary);">RM ' + parseFloat(item.price).toFixed(2) + '</div>' +
                        '</div>' +
                        '<div style="text-align: center;">' +
                        '<div style="font-size: 12px; font-weight: 600; color: var(--text-muted); margin-bottom: 4px;">Total</div>' +
                        '<div style="font-weight: 700; color: var(--text-primary);">RM ' + item.total.toFixed(2) + '</div>' +
                        '</div>' +
                        '</div>' +
                        '</div>';
                }
                
                html += '</div></div>';
            }
            
            if (total > 0) {
                html += '<div style="background: var(--accent-primary); border-radius: 12px; padding: 20px; margin-top: 20px; text-align: center; box-shadow: 0 6px 20px var(--shadow-medium);">' +
                    '<div style="font-size: 14px; font-weight: 600; color: rgba(255, 255, 255, 0.9); margin-bottom: 6px;">Total Quote Amount</div>' +
                    '<div style="font-size: 28px; font-weight: 800; color: #ffffff;">RM ' + total.toFixed(2) + '</div>' +
                    '</div>';
            }
            
            html += '</div>';
            container.innerHTML = html;
        }

        function editQuoteItem(index) {
            var item = currentQuoteItems[index];
            if (!item) return;
            
            document.getElementById('manual-description').value = item.description;
            document.getElementById('manual-quantity').value = item.quantity;
            document.getElementById('manual-price').value = item.price;
            document.getElementById('manual-unit').value = item.unit;
            document.getElementById('manual-category').value = item.category || 'common';
            
            deleteQuoteItem(index);
            updateManualTotal();
            showSuccessMessage('üìù Item loaded for editing');
        }

        function deleteQuoteItem(index) {
            if (index >= 0 && index < currentQuoteItems.length) {
                var item = currentQuoteItems[index];
                currentQuoteItems.splice(index, 1);
                updateQuoteItemsDisplay();
                showSuccessMessage('üóëÔ∏è "' + item.description + '" removed');
            }
        }

        function clearAllQuoteItems() {
            if (currentQuoteItems.length === 0) {
                showSuccessMessage('‚ÑπÔ∏è No items to clear');
                return;
            }
            
            if (confirm('Clear all quote items?\nThis action cannot be undone.')) {
                currentQuoteItems = [];
                updateQuoteItemsDisplay();
                showSuccessMessage('üóëÔ∏è All quote items cleared');
            }
        }

        function saveSimpleJob() {
            var title = document.getElementById('simple-job-title').value.trim();
            
            if (!title) {
                showSuccessMessage('‚ö†Ô∏è Please enter a job title!');
                return;
            }
            
            if (currentQuoteItems.length === 0) {
                showSuccessMessage('‚ö†Ô∏è Please add at least one quote item!');
                return;
            }
            
            var totalAmount = 0;
            for (var i = 0; i < currentQuoteItems.length; i++) {
                totalAmount += currentQuoteItems[i].total;
            }
            
            var jobData = {
                id: editingJob ? editingJob.id : Date.now(),
                title: title,
                items: [...currentQuoteItems],
                totalAmount: totalAmount,
                createdAt: editingJob ? editingJob.createdAt : new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            if (editingJob) {
                var index = jobQuotes.findIndex(function(job) { return job.id === editingJob.id; });
                if (index !== -1) {
                    jobQuotes[index] = jobData;
                }
                showSuccessMessage('‚úèÔ∏è Job quote updated successfully!');
            } else {
                jobQuotes.push(jobData);
                showSuccessMessage('‚úÖ Job quote created successfully!');
            }
            
            closeSimpleJobForm();
            saveDataToStorage();
            updateStats();
            renderViews();
            updateCategoryFilters();
            showView('quotes');
        }

        // Preset Management Functions
        function openPresetManager() {
            showView('presets');
        }

        function openPresetItemForm() {
            editingPreset = null;
            document.getElementById('preset-item-modal-title').textContent = '‚ûï Add Preset Item';
            document.getElementById('preset-item-form').reset();
            document.getElementById('preset-item-modal').classList.add('show');
        }

        function closePresetItemForm() {
            document.getElementById('preset-item-modal').classList.remove('show');
            editingPreset = null;
        }

        function handlePresetItemSubmit(e) {
            e.preventDefault();
            
            var name = document.getElementById('preset-item-name').value.trim();
            var price = parseFloat(document.getElementById('preset-item-price').value);
            
            if (!name || !price) {
                showSuccessMessage('‚ö†Ô∏è Please fill in all required fields!');
                return;
            }

            var itemData = {
                id: editingPreset ? editingPreset.id : (name.toLowerCase().replace(/[^a-z0-9]/g, '-') + '-' + Date.now()),
                name: name,
                description: document.getElementById('preset-item-description').value.trim(),
                price: price,
                unit: document.getElementById('preset-item-unit').value,
                category: document.getElementById('preset-item-category').value,
                createdAt: editingPreset ? editingPreset.createdAt : new Date().toISOString()
            };

            if (editingPreset) {
                var index = presetWorkItems.findIndex(function(item) { return item.id === editingPreset.id; });
                if (index !== -1) {
                    presetWorkItems[index] = itemData;
                }
                showSuccessMessage('‚úèÔ∏è Preset item updated successfully');
            } else {
                presetWorkItems.push(itemData);
                showSuccessMessage('‚úÖ Preset item added successfully');
            }

            closePresetItemForm();
            saveDataToStorage();
            updateStats();
            renderViews();
            updateCategoryFilters();
            renderPresetItems(document.getElementById('preset-category-selector').value);
        }

        function editPresetItem(id) {
            var item = presetWorkItems.find(function(item) { return item.id === id; });
            if (!item) return;

            editingPreset = item;
            document.getElementById('preset-item-modal-title').textContent = '‚úèÔ∏è Edit Preset Item';
            document.getElementById('preset-item-name').value = item.name;
            document.getElementById('preset-item-description').value = item.description || '';
            document.getElementById('preset-item-price').value = item.price;
            document.getElementById('preset-item-unit').value = item.unit;
            document.getElementById('preset-item-category').value = item.category;
            document.getElementById('preset-item-modal').classList.add('show');
        }

        function deletePresetItem(id) {
            var item = presetWorkItems.find(function(item) { return item.id === id; });
            if (!item) return;

            if (confirm('Delete preset item: "' + item.name + '"?\nThis action cannot be undone.')) {
                presetWorkItems = presetWorkItems.filter(function(item) { return item.id !== id; });
                saveDataToStorage();
                updateStats();
                renderViews();
                updateCategoryFilters();
                renderPresetItems(document.getElementById('preset-category-selector').value);
                showSuccessMessage('üóëÔ∏è Preset item deleted successfully');
            }
        }

        // Quote Management Functions
        function renderQuotes(searchTerm) {
            searchTerm = searchTerm || '';
            
            var filteredQuotes = jobQuotes.filter(function(quote) {
                var matchesSearch = quote.title.toLowerCase().indexOf(searchTerm.toLowerCase()) !== -1;
                var matchesCategory = currentQuoteFilter === 'all' || quoteHasCategory(quote, currentQuoteFilter);
                return matchesSearch && matchesCategory;
            });

            var container = document.getElementById('quotes-list');
            if (!container) return;
            
            if (filteredQuotes.length === 0) {
                container.innerHTML = '<div class="empty-state">' +
                    '<div class="empty-icon">üí∞</div>' +
                    '<p style="font-weight: 600;">No job quotes found</p>' +
                    '<p style="font-size: 14px; margin-top: 8px; color: var(--text-muted);">Create your first job quote or try different filters</p>' +
                    '</div>';
                return;
            }
            
            var quotesHTML = '';
            
            for (var i = 0; i < filteredQuotes.length; i++) {
                var quote = filteredQuotes[i];
                var quoteCategories = getQuoteCategories(quote);
                
                quotesHTML += '<div class="item-card">' +
                    '<div class="item-header">' +
                    '<div class="item-info">' +
                    '<h3>' + quote.title + '</h3>' +
                    '<div style="font-size: 14px; color: var(--text-secondary); margin: 8px 0;">' +
                    'üìã ' + quote.items.length + ' items ‚Ä¢ üìÖ ' + formatDate(quote.createdAt) +
                    '</div>' +
                    '<div style="margin: 8px 0;">' + renderCategoryBadges(quoteCategories) + '</div>' +
                    '</div>' +
                    '</div>' +
                    '<div class="item-actions">' +
                    '<button class="icon-btn quote-btn" onclick="viewQuote(' + quote.id + ')" title="View Quote">üëÅÔ∏è</button>' +
                    '<button class="icon-btn pdf-btn" onclick="generateQuotePDF(' + quote.id + ')" title="Generate PDF">üìÑ</button>' +
                    '<button class="icon-btn edit-btn" onclick="editQuote(' + quote.id + ')" title="Edit Quote">‚úèÔ∏è</button>' +
                    '<button class="icon-btn delete-btn" onclick="deleteQuote(' + quote.id + ')" title="Delete Quote">üóëÔ∏è</button>' +
                    '</div>' +
                    '<div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center;">' +
                    '<span style="font-size: 12px; color: var(--text-muted);">Items: ' + quote.items.length + '</span>' +
                    '<span style="font-size: 18px; color: var(--accent-primary); font-weight: 700;">RM ' + quote.totalAmount.toFixed(2) + '</span>' +
                    '</div>' +
                    '</div>';
            }
            
            container.innerHTML = quotesHTML;
        }

        function quoteHasCategory(quote, category) {
            for (var i = 0; i < quote.items.length; i++) {
                var item = quote.items[i];
                if ((item.category || 'common') === category) {
                    return true;
                }
            }
            return false;
        }

        function getQuoteCategories(quote) {
            var categories = {};
            for (var i = 0; i < quote.items.length; i++) {
                var item = quote.items[i];
                var category = item.category || 'common';
                categories[category] = true;
            }
            return Object.keys(categories);
        }

        function renderCategoryBadges(categoryList) {
            var html = '';
            for (var i = 0; i < categoryList.length && i < 3; i++) {
                var category = categoryList[i];
                html += '<span class="category-badge category-' + category + '">' + getCategoryIcon(category) + ' ' + getCategoryName(category) + '</span>';
            }
            if (categoryList.length > 3) {
                html += '<span class="category-badge" style="background: var(--text-muted);">+' + (categoryList.length - 3) + ' more</span>';
            }
            return html;
        }

        function viewQuote(quoteId) {
            var quote = jobQuotes.find(function(q) { return q.id === quoteId; });
            if (!quote) return;
            
            var quoteCategories = getQuoteCategories(quote);
            
            var quoteHTML = '<div class="card" style="margin-bottom: 20px;">' +
                '<div style="font-size: 18px; font-weight: 700; color: var(--accent-primary); margin-bottom: 8px;">üí∞ Job Quote #' + quote.id + '</div>' +
                '<div style="color: var(--text-secondary); font-size: 14px; font-weight: 600; margin-bottom: 12px;">' + quote.title + '</div>' +
                '<div>' + renderCategoryBadges(quoteCategories) + '</div>' +
                '</div>' +
                
                '<div class="card" style="margin-bottom: 20px;">' +
                '<h4 style="margin-bottom: 16px; color: var(--text-primary); font-weight: 700;">üìã Quote Details</h4>' +
                '<div style="display: grid; gap: 12px; font-size: 14px;">' +
                '<div><strong>Total Items:</strong> ' + quote.items.length + '</div>' +
                '<div><strong>Categories:</strong> ' + quoteCategories.length + '</div>' +
                '<div><strong>Created:</strong> ' + formatDate(quote.createdAt) + '</div>' +
                '<div><strong>Last Updated:</strong> ' + formatDate(quote.updatedAt) + '</div>' +
                '</div>' +
                '</div>';
            
            if (quote.items.length > 0) {
                // Group items by category for display
                var groupedItems = {};
                for (var i = 0; i < quote.items.length; i++) {
                    var item = quote.items[i];
                    var category = item.category || 'common';
                    if (!groupedItems[category]) {
                        groupedItems[category] = [];
                    }
                    groupedItems[category].push(item);
                }
                
                quoteHTML += '<div class="card" style="margin-bottom: 20px;">' +
                    '<h4 style="margin-bottom: 16px; color: var(--text-primary); font-weight: 700;">üíº Quote Items by Category</h4>';
                
                for (var category in groupedItems) {
                    var categoryItems = groupedItems[category];
                    var categoryTotal = 0;
                    
                    for (var j = 0; j < categoryItems.length; j++) {
                        categoryTotal += categoryItems[j].total;
                    }
                    
                    quoteHTML += '<div style="margin-bottom: 16px; border-radius: 12px; overflow: hidden; border: 2px solid ' + getCategoryColor(category) + '; box-shadow: 0 4px 12px var(--shadow-light);">' +
                        '<div style="padding: 16px 20px; background: var(--bg-secondary); display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color);">' +
                        '<div style="display: flex; align-items: center; gap: 12px; font-weight: 700; font-size: 16px; color: var(--text-primary);">' +
                        '<div style="width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-size: 16px; background: ' + getCategoryColor(category) + ';">' + getCategoryIcon(category) + '</div>' +
                        '<span>' + getCategoryName(category) + '</span>' +
                        '</div>' +
                        '<div style="display: flex; align-items: center; gap: 12px; font-size: 12px; color: var(--text-muted);">' +
                        '<span>' + categoryItems.length + ' items</span>' +
                        '<span style="font-weight: 700; color: var(--accent-primary);">RM ' + categoryTotal.toFixed(2) + '</span>' +
                        '</div>' +
                        '</div>' +
                        '<div style="background: var(--bg-card);">';
                    
                    for (var j = 0; j < categoryItems.length; j++) {
                        var item = categoryItems[j];
                        
                        quoteHTML += '<div style="background: var(--bg-secondary); border-radius: 12px; padding: 16px; margin: 12px; border: 1px solid var(--border-color);">' +
                            '<div style="font-weight: 700; margin-bottom: 8px; color: var(--text-primary);">' +
                            '<span style="margin-right: 8px;">' + getCategoryIcon(category) + '</span>' +
                            item.description + (item.isPreset ? ' üè∑Ô∏è' : '') + '</div>' +
                            '<div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; font-size: 13px; color: var(--text-secondary);">' +
                            '<div><strong>Qty:</strong> ' + item.quantity + ' ' + item.unit + '</div>' +
                            '<div><strong>Price:</strong> RM ' + parseFloat(item.price).toFixed(2) + '</div>' +
                            '<div><strong>Total:</strong> RM ' + item.total.toFixed(2) + '</div>' +
                            '</div>' +
                            '</div>';
                    }
                    
                    quoteHTML += '</div></div>';
                }
                
                quoteHTML += '<div style="background: var(--accent-primary); border-radius: 12px; padding: 20px; margin-top: 20px; text-align: center; box-shadow: 0 6px 20px var(--shadow-medium);">' +
                    '<div style="font-size: 14px; font-weight: 600; color: rgba(255, 255, 255, 0.9); margin-bottom: 6px;">Total Quote Amount</div>' +
                    '<div style="font-size: 28px; font-weight: 800; color: #ffffff;">RM ' + quote.totalAmount.toFixed(2) + '</div>' +
                    '</div>' +
                    '</div>';
            }
            
            quoteHTML += '<div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-top: 20px;">' +
                '<button onclick="generateQuotePDF(' + quote.id + ')" class="btn btn-success" style="font-size: 14px;">üìÑ Generate PDF</button>' +
                '<button onclick="editQuote(' + quote.id + ')" class="btn btn-primary" style="font-size: 14px;">‚úèÔ∏è Edit Quote</button>' +
                '</div>';
            
            document.getElementById('quote-view-content').innerHTML = quoteHTML;
            document.getElementById('quote-view-modal').classList.add('show');
        }

        function closeQuoteView() {
            document.getElementById('quote-view-modal').classList.remove('show');
        }

        function editQuote(quoteId) {
            var quote = jobQuotes.find(function(q) { return q.id === quoteId; });
            if (!quote) return;
            
            editingJob = quote;
            currentQuoteItems = [...quote.items];
            
            document.getElementById('simple-job-modal-title').textContent = '‚úèÔ∏è Edit Job Quote';
            document.getElementById('simple-job-title').value = quote.title;
            document.getElementById('preset-category-selector').value = 'all';
            
            renderPresetItems('all');
            updateQuoteItemsDisplay();
            document.getElementById('simple-job-modal').classList.add('show');
            showSuccessMessage('‚úèÔ∏è Editing: ' + quote.title);
        }

        function deleteQuote(quoteId) {
            var quote = jobQuotes.find(function(q) { return q.id === quoteId; });
            if (!quote) return;

            if (confirm('Delete job quote: "' + quote.title + '"?\nThis action cannot be undone.')) {
                jobQuotes = jobQuotes.filter(function(q) { return q.id !== quoteId; });
                saveDataToStorage();
                updateStats();
                renderViews();
                updateCategoryFilters();
                showSuccessMessage('üóëÔ∏è Job quote deleted successfully');
            }
        }

        function generateQuotePDF(quoteId) {
            showSuccessMessage('üìÑ Enhanced PDF generation with pastel orange theme coming soon!');
        }

        // Preset List Rendering
        function renderPresets(searchTerm) {
            searchTerm = searchTerm || '';
            
            var filteredPresets = presetWorkItems.filter(function(preset) {
                var matchesSearch = preset.name.toLowerCase().indexOf(searchTerm.toLowerCase()) !== -1 ||
                       (preset.description && preset.description.toLowerCase().indexOf(searchTerm.toLowerCase()) !== -1);
                var matchesCategory = currentPresetFilter === 'all' || preset.category === currentPresetFilter;
                return matchesSearch && matchesCategory;
            });

            var container = document.getElementById('presets-list');
            if (!container) return;
            
            if (filteredPresets.length === 0) {
                container.innerHTML = '<div class="empty-state">' +
                    '<div class="empty-icon">üìã</div>' +
                    '<p style="font-weight: 600;">No preset items found</p>' +
                    '<p style="font-size: 14px; margin-top: 8px; color: var(--text-muted);">Create preset items or try different filters</p>' +
                    '</div>';
                return;
            }
            
            // Group presets by category
            var groupedPresets = {};
            for (var i = 0; i < filteredPresets.length; i++) {
                var preset = filteredPresets[i];
                var category = preset.category || 'common';
                if (!groupedPresets[category]) {
                    groupedPresets[category] = [];
                }
                groupedPresets[category].push(preset);
            }
            
            var presetsHTML = '';
            
            if (currentPresetFilter === 'all') {
                // Show all categories grouped
                for (var category in groupedPresets) {
                    var categoryPresets = groupedPresets[category];
                    if (categoryPresets.length === 0) continue;
                    
                    var categoryTotal = 0;
                    for (var j = 0; j < categoryPresets.length; j++) {
                        categoryTotal += categoryPresets[j].price;
                    }
                    var categoryAverage = categoryTotal / categoryPresets.length;
                    
                    presetsHTML += '<div style="margin-bottom: 24px; border-radius: 16px; overflow: hidden; border: 2px solid ' + getCategoryColor(category) + '; transition: all 0.2s ease;">' +
                        '<div style="padding: 16px 20px; background: var(--bg-secondary); display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color);">' +
                        '<div style="display: flex; align-items: center; gap: 12px; font-weight: 700; font-size: 16px; color: var(--text-primary);">' +
                        '<div style="width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-size: 16px; background: ' + getCategoryColor(category) + ';">' + getCategoryIcon(category) + '</div>' +
                        '<span>' + getCategoryName(category) + '</span>' +
                        '</div>' +
                        '<div style="display: flex; align-items: center; gap: 12px; font-size: 12px; color: var(--text-muted);">' +
                        '<span>' + categoryPresets.length + ' items</span>' +
                        '<span>Avg: RM ' + categoryAverage.toFixed(0) + '</span>' +
                        '</div>' +
                        '</div>' +
                        '<div style="background: var(--bg-card);">';
                    
                    for (var j = 0; j < categoryPresets.length; j++) {
                        presetsHTML += renderPresetCard(categoryPresets[j]);
                    }
                    
                    presetsHTML += '</div></div>';
                }
            } else {
                // Show filtered category only
                for (var i = 0; i < filteredPresets.length; i++) {
                    presetsHTML += renderPresetCard(filteredPresets[i]);
                }
            }
            
            container.innerHTML = presetsHTML;
        }

        function renderPresetCard(preset) {
            var usageCount = 0;
            
            // Count usage in quotes
            for (var j = 0; j < jobQuotes.length; j++) {
                for (var k = 0; k < jobQuotes[j].items.length; k++) {
                    if (jobQuotes[j].items[k].presetId === preset.id) {
                        usageCount++;
                    }
                }
            }
            
            return '<div class="item-card">' +
                '<div class="item-header">' +
                '<div class="item-info">' +
                '<h3>' +
                '<span style="margin-right: 8px;">' + getCategoryIcon(preset.category) + '</span>' +
                preset.name + '</h3>' +
                '<div style="font-size: 14px; color: var(--text-secondary); margin: 8px 0;">' +
                preset.description + '</div>' +
                '<div style="font-size: 12px; color: var(--text-muted);">' +
                'üìè ' + preset.unit + ' ‚Ä¢ ' +
                'üìà Used ' + usageCount + ' times' +
                '</div>' +
                '</div>' +
                '</div>' +
                '<div class="item-actions">' +
                '<button class="icon-btn edit-btn" onclick="editPresetItem(\'' + preset.id + '\')" title="Edit Preset">‚úèÔ∏è</button>' +
                '<button class="icon-btn delete-btn" onclick="deletePresetItem(\'' + preset.id + '\')" title="Delete Preset">üóëÔ∏è</button>' +
                '</div>' +
                '<div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center;">' +
                '<span style="font-size: 12px; color: var(--text-muted);">Usage: ' + usageCount + '</span>' +
                '<span style="font-size: 18px; color: var(--accent-primary); font-weight: 700;">RM ' + parseFloat(preset.price).toFixed(2) + '</span>' +
                '</div>' +
                '</div>';
        }

        // Export Data Function
        function exportData() {
            var allData = {
                companySettings: companySettings,
                userInfo: userInfo,
                jobQuotes: jobQuotes,
                presetWorkItems: presetWorkItems,
                selectedLogo: selectedLogoIndex,
                customLogo: customLogo,
                customIcons: customIcons,
                themePreference: currentTheme,
                categories: categories,
                exportDate: new Date().toISOString(),
                version: '5.0-pastel-orange'
            };
            
            var dataStr = JSON.stringify(allData, null, 2);
            var dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            var link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = 'REFIT_PastelOrange_' + new Date().toISOString().split('T')[0] + '.json';
            link.click();
            
            showSuccessMessage('üì§ Pastel orange themed data exported successfully!');
        }

        // Event Listeners
        function setupEventListeners() {
            // Search functionality
            var quoteSearch = document.getElementById('quote-search');
            if (quoteSearch) {
                quoteSearch.addEventListener('input', function(e) {
                    renderQuotes(e.target.value);
                });
            }

            var presetSearch = document.getElementById('preset-search');
            if (presetSearch) {
                presetSearch.addEventListener('input', function(e) {
                    renderPresets(e.target.value);
                });
            }

            // Forms
            var presetItemForm = document.getElementById('preset-item-form');
            if (presetItemForm) {
                presetItemForm.addEventListener('submit', handlePresetItemSubmit);
            }

            // Manual item calculations
            var quantityInput = document.getElementById('manual-quantity');
            var priceInput = document.getElementById('manual-price');
            
            if (quantityInput) {
                quantityInput.addEventListener('input', updateManualTotal);
            }
            
            if (priceInput) {
                priceInput.addEventListener('input', updateManualTotal);
            }

            // System theme detection
            if (window.matchMedia) {
                var mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
                mediaQuery.addEventListener('change', function(e) {
                    if (!localStorage.getItem(STORAGE_KEYS.THEME_PREFERENCE)) {
                        currentTheme = e.matches ? 'dark' : 'light';
                        document.body.setAttribute('data-theme', currentTheme);
                        updateThemeToggle();
                    }
                });
            }

            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey || e.metaKey) {
                    switch(e.key.toLowerCase()) {
                        case 'n':
                            e.preventDefault();
                            openSimpleJobForm();
                            break;
                        case 'p':
                            e.preventDefault();
                            openPresetItemForm();
                            break;
                        case 'e':
                            e.preventDefault();
                            exportData();
                            break;
                        case 'u':
                            e.preventDefault();
                            openUserInfo();
                            break;
                        case 'i':
                            e.preventDefault();
                            openIconUpload();
                            break;
                        case 'd':
                            e.preventDefault();
                            toggleTheme();
                            break;
                    }
                }
                
                if (e.key === 'Escape') {
                    var modals = document.querySelectorAll('.modal.show');
                    for (var i = 0; i < modals.length; i++) {
                        modals[i].classList.remove('show');
                    }
                }
            });
        }

        function updateThemeToggle() {
            var toggleBtn = document.getElementById('theme-toggle');
            if (toggleBtn) {
                toggleBtn.textContent = currentTheme === 'light' ? 'üåô Dark' : '‚òÄÔ∏è Light';
            }
        }

        // Utility Functions
        function showView(viewName) {
            currentView = viewName;
            
            // Hide all views
            var views = document.querySelectorAll('.view');
            for (var i = 0; i < views.length; i++) {
                views[i].classList.add('hidden');
            }
            
            // Show selected view
            var targetView = document.getElementById(viewName + '-view');
            if (targetView) {
                targetView.classList.remove('hidden');
            }
            
            // Update navigation
            var navItems = document.querySelectorAll('.nav-item');
            for (var i = 0; i < navItems.length; i++) {
                navItems[i].classList.remove('active');
            }
            
            var activeNav = document.querySelector('.nav-item[onclick*="' + viewName + '"]');
            if (activeNav) {
                activeNav.classList.add('active');
            }
            
            // Reset filters when changing views
            if (viewName === 'quotes') {
                currentQuoteFilter = 'all';
            } else if (viewName === 'presets') {
                currentPresetFilter = 'all';
            }
            
            // Render view content
            renderViews();
        }

        function renderViews() {
            switch(currentView) {
                case 'dashboard':
                    renderDashboard();
                    break;
                case 'quotes':
                    renderQuotes();
                    updateQuoteCategoryFilters();
                    break;
                case 'presets':
                    renderPresets();
                    updatePresetCategoryFilters();
                    break;
            }
        }

        function renderDashboard() {
            // Render recent quotes
            var recentQuotes = jobQuotes.slice(-3).reverse();
            var container = document.getElementById('recent-quotes');
            if (!container) return;
            
            if (recentQuotes.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 30px 20px; color: var(--text-muted);">' +
                    '<div style="font-size: 32px; margin-bottom: 8px;">üí∞</div>' +
                    '<p style="font-weight: 600;">No job quotes yet</p>' +
                    '<p style="font-size: 12px; margin-top: 4px;">Create your first job quote</p>' +
                    '</div>';
                return;
            }
            
            var html = '';
            for (var i = 0; i < recentQuotes.length; i++) {
                var quote = recentQuotes[i];
                var quoteCategories = getQuoteCategories(quote);
                
                html += '<div style="background: var(--bg-secondary); border-radius: 12px; padding: 16px; margin-bottom: 12px; border: 1px solid var(--border-color); cursor: pointer; transition: all 0.2s ease;" onclick="viewQuote(' + quote.id + ')" onmouseover="this.style.transform=\'scale(1.02)\'" onmouseout="this.style.transform=\'scale(1)\'">' +
                    '<div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px;">' +
                    '<div style="font-weight: 700; font-size: 15px; color: var(--text-primary);">' + quote.title + '</div>' +
                    '</div>' +
                    '<div style="font-size: 12px; color: var(--text-muted); margin-bottom: 8px;">üìã ' + quote.items.length + ' items ‚Ä¢ üìÖ ' + formatDate(quote.createdAt) + '</div>' +
                    '<div style="margin-bottom: 8px;">' + renderCategoryBadges(quoteCategories) + '</div>' +
                    '<div style="display: flex; justify-content: space-between; align-items: center; font-size: 12px;">' +
                    '<span style="color: var(--text-muted);">Quote #' + quote.id + '</span>' +
                    '<span style="font-weight: 700; color: var(--accent-primary); font-size: 16px;">RM ' + quote.totalAmount.toFixed(2) + '</span>' +
                    '</div>' +
                    '</div>';
            }
            
            container.innerHTML = html;
            
            // Render category statistics
            renderCategoryStatistics();
        }

        function renderCategoryStatistics() {
            var container = document.getElementById('category-stats-grid');
            if (!container) return;
            
            var categoryStats = {};
            var totalItems = 0;
            
            // Initialize category stats
            for (var catKey in categories) {
                categoryStats[catKey] = {
                    count: 0,
                    revenue: 0,
                    items: 0
                };
            }
            
            // Calculate statistics
            for (var i = 0; i < jobQuotes.length; i++) {
                var quote = jobQuotes[i];
                for (var j = 0; j < quote.items.length; j++) {
                    var item = quote.items[j];
                    var category = item.category || 'common';
                    totalItems++;
                    
                    if (categoryStats[category]) {
                        categoryStats[category].items++;
                        categoryStats[category].revenue += item.total;
                    }
                }
            }
            
            // Count quotes per category
            for (var i = 0; i < jobQuotes.length; i++) {
                var quote = jobQuotes[i];
                var quoteCategories = getQuoteCategories(quote);
                for (var j = 0; j < quoteCategories.length; j++) {
                    var category = quoteCategories[j];
                    if (categoryStats[category]) {
                        categoryStats[category].count++;
                    }
                }
            }
            
            var html = '';
            var categoriesWithData = [];
            
            // Find categories with actual data
            for (var catKey in categoryStats) {
                var stats = categoryStats[catKey];
                if (stats.count > 0 || stats.items > 0) {
                    categoriesWithData.push({ key: catKey, stats: stats });
                }
            }
            
            // Sort by revenue (highest first)
            categoriesWithData.sort(function(a, b) {
                return b.stats.revenue - a.stats.revenue;
            });
            
            // Show top 6 categories with data
            for (var i = 0; i < Math.min(6, categoriesWithData.length); i++) {
                var catData = categoriesWithData[i];
                var catKey = catData.key;
                var stats = catData.stats;
                var percentage = totalItems > 0 ? Math.round((stats.items / totalItems) * 100) : 0;
                
                html += '<div style="background: var(--bg-secondary); border-radius: 12px; padding: 16px; border: 1px solid var(--border-color); transition: all 0.2s ease;" onmouseover="this.style.transform=\'scale(1.05)\'" onmouseout="this.style.transform=\'scale(1)\'">' +
                    '<div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">' +
                    '<div style="width: 24px; height: 24px; border-radius: 6px; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; background: ' + getCategoryColor(catKey) + ';">' + getCategoryIcon(catKey) + '</div>' +
                    '<span style="font-weight: 700; font-size: 12px; color: var(--text-primary);">' + getCategoryName(catKey) + '</span>' +
                    '</div>' +
                    '<div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; font-size: 12px;">' +
                    '<div style="text-align: center;">' +
                    '<div style="color: var(--text-muted);">Quotes</div>' +
                    '<div style="font-weight: 700; color: var(--accent-primary);">' + stats.count + '</div>' +
                    '</div>' +
                    '<div style="text-align: center;">' +
                    '<div style="color: var(--text-muted);">Revenue</div>' +
                    '<div style="font-weight: 700; color: var(--accent-warm);">RM ' + Math.round(stats.revenue) + '</div>' +
                    '</div>' +
                    '</div>' +
                    '<div style="margin-top: 8px; text-align: center;">' +
                    '<div style="color: var(--text-muted); font-size: 11px;">' + percentage + '% of items</div>' +
                    '</div>' +
                    '</div>';
            }
            
            if (html === '') {
                html = '<div style="grid-column: 1 / -1; text-align: center; padding: 20px; color: var(--text-muted);">' +
                    '<div style="font-size: 24px; margin-bottom: 8px;">üìä</div>' +
                    '<p>No category data yet</p>' +
                    '<p style="font-size: 12px; margin-top: 4px;">Create quotes to see category breakdown</p>' +
                    '</div>';
            }
            
            container.innerHTML = html;
        }

        function updateStats() {
            // Calculate statistics
            var totalQuotes = jobQuotes.length;
            var totalItems = 0;
            var totalRevenue = 0;
            var todayRevenue = 0;
            var presetUsage = 0;
            var totalPresetItems = 0;
            var activeCategories = {};
            
            var today = new Date().toISOString().split('T')[0];
            
            for (var i = 0; i < jobQuotes.length; i++) {
                var quote = jobQuotes[i];
                totalItems += quote.items.length;
                totalRevenue += quote.totalAmount;
                
                // Today's revenue (quotes created today)
                if (quote.createdAt.split('T')[0] === today) {
                    todayRevenue += quote.totalAmount;
                }
                
                // Count preset usage and categories
                for (var j = 0; j < quote.items.length; j++) {
                    var item = quote.items[j];
                    totalPresetItems++;
                    if (item.isPreset) {
                        presetUsage++;
                    }
                    var category = item.category || 'common';
                    activeCategories[category] = true;
                }
            }
            
            var presetUsagePercent = totalPresetItems > 0 ? Math.round((presetUsage / totalPresetItems) * 100) : 0;
            var averageQuote = totalQuotes > 0 ? totalRevenue / totalQuotes : 0;
            var totalActiveCategories = Object.keys(activeCategories).length;
            
            // Calculate preset statistics
            var categories = {};
            var totalPresetPrice = 0;
            for (var i = 0; i < presetWorkItems.length; i++) {
                categories[presetWorkItems[i].category] = true;
                totalPresetPrice += presetWorkItems[i].price;
            }
            var categoryCount = Object.keys(categories).length;
            var avgPresetPrice = presetWorkItems.length > 0 ? totalPresetPrice / presetWorkItems.length : 0;
            
            // Update DOM elements
            updateElementText('total-quotes-count', totalQuotes);
            updateElementText('total-items-count', totalItems);
            updateElementText('today-revenue', 'RM ' + Math.round(todayRevenue));
            updateElementText('total-revenue', 'RM ' + Math.round(totalRevenue));
            updateElementText('average-quote', 'RM ' + Math.round(averageQuote));
            updateElementText('total-categories', totalActiveCategories);
            updateElementText('daily-revenue', 'RM ' + todayRevenue.toFixed(2));
            
            // Preset statistics
            updateElementText('preset-count', presetWorkItems.length + ' items');
            updateElementText('category-count', categoryCount);
            updateElementText('avg-preset-price', 'RM ' + Math.round(avgPresetPrice));
            updateElementText('preset-usage-count', presetUsage);
        }

        function updateElementText(elementId, text) {
            var element = document.getElementById(elementId);
            if (element) {
                element.textContent = text;
            }
        }

        function formatDate(dateString) {
            if (!dateString) return '';
            var date = new Date(dateString);
            return date.toLocaleDateString('en-MY', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric' 
            });
        }

        function updateStatusBar() {
            var now = new Date();
            var timeString = now.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: false 
            });
            
            var timeElement = document.getElementById('status-time');
            if (timeElement) {
                timeElement.textContent = timeString;
            }
        }

        function updateCurrentDate() {
            var today = new Date();
            var dateString = today.toLocaleDateString('en-MY', { 
                weekday: 'long',
                month: 'long', 
                day: 'numeric' 
            });
            
            var dateElement = document.getElementById('current-date');
            if (dateElement) {
                dateElement.textContent = dateString;
            }
        }

        function setupMobileOptimizations() {
            // Update status bar every minute
            setInterval(updateStatusBar, 60000);
            
            // Prevent zoom on double tap
            var lastTouchEnd = 0;
            document.addEventListener('touchend', function (event) {
                var now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false);

            // Touch gesture support
            setupTouchGestures();
        }

        function showSuccessMessage(message) {
            var messageElement = document.getElementById('success-message');
            if (!messageElement) return;
            
            messageElement.textContent = message;
            messageElement.classList.add('show');
            
            setTimeout(function() {
                messageElement.classList.remove('show');
            }, 3000);
        }

        // Touch Gesture Enhancements
        function setupTouchGestures() {
            var startX, startY, distX, distY;
            var threshold = 150;
            var restraint = 100;
            var allowedTime = 300;
            var elapsedTime;
            var startTime;
            
            document.addEventListener('touchstart', function(e) {
                var touchobj = e.changedTouches[0];
                startX = touchobj.pageX;
                startY = touchobj.pageY;
                startTime = new Date().getTime();
            }, false);
            
            document.addEventListener('touchend', function(e) {
                var touchobj = e.changedTouches[0];
                distX = touchobj.pageX - startX;
                distY = touchobj.pageY - startY;
                elapsedTime = new Date().getTime() - startTime;
                
                if (elapsedTime <= allowedTime) {
                    if (Math.abs(distX) >= threshold && Math.abs(distY) <= restraint) {
                        if (distX > 0) {
                            handleSwipeRight();
                        } else {
                            handleSwipeLeft();
                        }
                    }
                }
            }, false);
        }

        function handleSwipeLeft() {
            var views = ['dashboard', 'quotes', 'presets'];
            var currentIndex = views.indexOf(currentView);
            var nextIndex = (currentIndex + 1) % views.length;
            showView(views[nextIndex]);
        }

        function handleSwipeRight() {
            var views = ['dashboard', 'quotes', 'presets'];
            var currentIndex = views.indexOf(currentView);
            var prevIndex = currentIndex === 0 ? views.length - 1 : currentIndex - 1;
            showView(views[prevIndex]);
        }

        // Legacy logo functions (keeping for compatibility)
        var logoTemplates = [
            `<svg class="logo-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <path d="M20 65L35 50L30 45L45 30C50 25 60 25 65 30C70 35 70 45 65 50L50 65L45 60L30 75C25 80 15 80 10 75C5 70 5 60 10 55L20 65Z" fill="currentColor" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                <path d="M70 20L80 30L75 35L85 45C87 47 87 51 85 53L75 63L70 58L60 68C58 70 54 70 52 68L42 58L47 53L37 43C35 41 35 37 37 35L47 25L52 30L62 20C64 18 68 18 70 20Z" fill="currentColor" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                <circle cx="50" cy="50" r="8" fill="rgba(255,255,255,0.8)" stroke="currentColor" stroke-width="2"/>
                <circle cx="50" cy="50" r="3" fill="currentColor"/>
            </svg>`
        ];

        function openLogoSelector() {
            showSuccessMessage('üí° Use the User Info button (üë§) to upload your custom logo!');
        }

        function loadSelectedLogo() {
            if (customLogo) {
                applyCustomLogo();
            }
        }

        // Auto-save functionality
        var autoSaveInterval;

        function startAutoSave() {
            autoSaveInterval = setInterval(function() {
                saveDataToStorage();
            }, 60000); // Auto-save every minute
        }

        function stopAutoSave() {
            if (autoSaveInterval) {
                clearInterval(autoSaveInterval);
            }
        }

        // Initialize all features when app loads
        window.addEventListener('load', function() {
            startAutoSave();
            
            console.log('üîß REFIT MAINTENANCE SERVICES - Pastel Orange Theme Loaded');
            console.log('üçë Beautiful Pastel Orange Color Scheme');
            console.log('üé® Custom Icon Upload & User Info Management');
            console.log('üèóÔ∏è 24 Professional Categories for Construction & Services');
            console.log('üëÅÔ∏è Eye-Friendly Design for Extended Use');
            console.log('üì± Mobile-Optimized with Touch Gestures');
            console.log('üíæ Auto-save & Data Protection Enabled');
        });

        // Cleanup when page unloads
        window.addEventListener('beforeunload', function() {
            stopAutoSave();
            saveDataToStorage(); // Final save
        });

        // Enhanced error handling
        window.addEventListener('error', function(e) {
            console.error('Application error:', e.error);
            showSuccessMessage('‚ö†Ô∏è Minor issue detected. App continues working normally.');
        });

        console.log('üçë REFIT ENHANCED - Pastel Orange Theme Ready');
        console.log('üé® Custom Icon Upload System');
        console.log('üë§ User Info & Logo Management');
        console.log('üèóÔ∏è 24 Professional Categories');
        console.log('üì± Touch-Friendly Mobile Experience');
        console.log('üçë Beautiful Pastel Orange Color Scheme');
    </script>
</body>
</html>
